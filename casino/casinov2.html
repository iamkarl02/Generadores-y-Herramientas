<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ruleta Casino</title>
  <link rel="icon" href="../pikachu.png" type="image/png">
  <style>
    /* Estilos Generales y Reseteo */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 8px; /* Reducido de 10px */
      /* Fondo tipo madera */
      background-color: #4a2c0e; /* Color base de la madera */
      background-image:
        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.05) 0%, rgba(0, 0, 0, 0.2) 100%),
        linear-gradient(180deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.1) 50%, rgba(0, 0, 0, 0.3) 100%),
        linear-gradient(135deg, #5c3a1a 0%, #3a220c 50%, #5c3a1a 100%);
      background-size: 100% 100%, 100% 100%, 100% 100%;
      background-blend-mode: overlay, overlay, normal;
      color: white; font-family: 'Segoe UI', sans-serif;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      grid-template-rows: auto 1fr;
      grid-template-areas:
        "dock dock dock"
        "reproductor ruleta apuestas";
      gap: 16px; /* Reducido de 20px */
      min-height: 100vh;
      overflow: hidden;
    }

    /* Estilos para el Dock de Navegaci√≥n */
    .dock {
      grid-area: dock;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 16px; /* Reducido de 10px 20px */
      border-radius: 0 0 8px 8px; /* Reducido de 10px */
      display: flex;
      justify-content: center;
      gap: 24px; /* Reducido de 30px */
      box-shadow: 0 4px 12px rgba(0, 255, 0, 0.3); /* Reducido de 5px 15px */
      margin-bottom: 8px; /* Reducido de 10px */
    }
    .dock a {
      color: #0f0;
      text-decoration: none;
      font-size: 0.96rem; /* Reducido de 1.2rem */
      font-weight: bold;
      padding: 4px 8px; /* Reducido de 5px 10px */
      border-radius: 4px; /* Reducido de 5px */
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .dock a:hover {
      background-color: #00cc44;
      color: #fff;
      box-shadow: 0 0 8px #0f0; /* Reducido de 10px */
    }

    /* Estilos para el Canvas de la Ruleta */
    .wheel-frame {
      grid-area: ruleta;
      padding: 14px; /* Reducido de 18px */
      border-radius: 999px;
      background:
        radial-gradient(circle at 50% 40%, #ffe8d0, #cfa07a 35%, #6f4a2b 70%),
        linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.2));
      box-shadow: 0 11px 32px rgba(0,0,0,0.6), inset 0 6px 19px rgba(255,255,255,0.03); /* Reducido de 14px 40px, 8px 24px */
      display: flex;
      justify-content: center;
      align-items: center;
      margin: auto;
      max-width: 100%;
      max-height: 100%;
    }
    canvas#ruletaCanvas {
      background: transparent;
      display:block;
      max-width: 560px; /* Reducido de 700px */
      max-height: 560px; /* Reducido de 700px */
      width: 100%;
      height: auto;
      border-radius:50%;
      box-shadow: 0 8px 24px rgba(0,0,0,0.6); /* Reducido de 10px 30px */
    }

    /* Estilos Comunes para Paneles Laterales y Controles */
    .controls {
      background: rgba(0, 0, 0, 0.6);
      box-shadow: 0 0 12px #005500; /* Reducido de 15px */
      font-size: 0.8rem; /* Reducido de 1rem */
      padding: 8px; /* Reducido de 10px */
      border-radius: 8px; /* Reducido de 10px */
    }

    /* Estilos para el Panel de Apuestas */
    .controls {
      grid-area: apuestas;
      display: flex;
      flex-direction: column;
      gap: 10px; /* Reducido de 12px */
      overflow-y: auto;
      padding: 12px; /* Reducido de 15px */
      width: auto;
      height: auto;
    }

    /* Estilos para T√≠tulos de Secci√≥n (Apuestas) */
    .controls h2 {
      margin-top: 0;
      color: #0f0;
      text-align: center;
      text-shadow: 0 0 4px #00ff55; /* Reducido de 5px */
      font-size: 1.04rem; /* Reducido de 1.3rem */
    }

    /* Estilos Comunes para Inputs y Botones */
    input, button {
      padding: 8px; /* Reducido de 10px */
      border-radius: 5px; /* Reducido de 6px */
      border: 2px solid #0f0;
      background: #0a0;
      color: #ddffdd;
      font-size: 0.88rem; /* Reducido de 1.1rem */
      font-weight: 600;
      text-align: center;
    }
    input:focus {
      outline: none;
      border-color: #6f6;
      background: #0f0;
      color: #003300;
      box-shadow: 0 0 8px #6f6; /* Reducido de 10px */
    }
    button {
      background-color: #00cc44;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #00bb33;
      box-shadow: 0 0 12px #0f0; /* Reducido de 15px */
    }

    /* Estilos para la Tabla de Pagos */
    #paymentInfo {
        background: #002200;
        padding: 8px; /* Reducido de 10px */
        border-radius: 6px; /* Reducido de 8px */
        box-shadow: inset 0 0 8px #0a0; /* Reducido de 10px */
        margin-bottom: 10px; /* Reducido de 12px */
        font-size: 0.76rem; /* Reducido de 0.95rem */
        color: #ddffdd;
        text-align: left;
    }
    #paymentInfo h3 {
        margin-top: 0;
        margin-bottom: 4px; /* Reducido de 5px */
        color: #0f0;
        text-align: center;
        text-shadow: none;
        font-size: 0.96rem; /* Reducido de 1.2rem */
    }
    #paymentInfo p {
        margin: 0;
        line-height: 1.2; /* Reducido de 1.4 */
    }
    #paymentInfo span {
        font-weight: bold;
        color: #0f0;
    }
    #paymentInfo .red-text { color: red; }
    #paymentInfo .black-text { color: #ccc; }
    #paymentInfo .green-text { color: green; }
    #paymentInfo .white-text { color: white; }

    /* Ajustes Espec√≠ficos para la Secci√≥n de Apuestas */
    .controls input, .controls button {
        margin-bottom: 6px; /* Reducido de 8px */
    }
    .controls input:last-of-type, .controls button:last-of-type {
        margin-bottom: 0;
    }

    /* Contenedor para los botones de apostar y girar */
    .bet-spin-buttons {
        display: flex;
        gap: 8px; /* Reducido de 10px */
        margin-top: 16px; /* Reducido de 20px */
    }
    .bet-spin-buttons button {
        flex: 1;
        padding: 8px; /* Reducido de 10px */
        font-size: 0.8rem; /* Reducido de 1rem */
    }

    /* Estilos para Modales (Configuraci√≥n y Fin de Juego) */
    #configModal, #endGameModal, #infoModal, #playerSelectModal, #adminLoginModal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0; top: 0;
        width: 100%; height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
    }
    #endGameModal {
        display: none;
    }

    .modal-content {
        background: rgba(0, 0, 0, 0.9);
        padding: 20px; /* Reducido de 25px */
        border: 2px solid #0f0;
        border-radius: 12px; /* Reducido de 15px */
        width: 80%;
        max-width: 360px; /* Reducido de 450px */
        box-shadow: 0 0 20px #0f0; /* Reducido de 25px */
        text-align: center;
        color: white;
    }
    .modal-content h2 {
        color: #0f0;
        text-shadow: 0 0 6px #00ff55; /* Reducido de 8px */
        margin-top: 0;
        font-size: 1.6rem; /* Reducido de 2rem */
    }
    .modal-content p {
        font-size: 0.88rem; /* Reducido de 1.1rem */
        margin-bottom: 10px; /* Reducido de 12px */
    }
    .modal-content input[type="number"], .modal-content input[type="text"], .modal-content input[type="password"] {
        width: calc(100% - 16px); /* Ajustado de 20px */
        margin-bottom: 10px; /* Reducido de 12px */
        padding: 10px; /* Reducido de 12px */
        font-size: 0.88rem; /* Reducido de 1.1rem */
    }
    .modal-content button {
        width: 100%;
        padding: 11px; /* Reducido de 14px */
        font-size: 1.04rem; /* Reducido de 1.3rem */
        background-color: #00cc44;
        border: 2px solid #0f0;
        margin-top: 10px; /* Reducido de 12px */
    }
    .modal-content button:hover {
        background-color: #00bb33;
        box-shadow: 0 0 14px #0f0; /* Reducido de 18px */
    }
    .modal-content .checkbox-group {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px; /* Reducido de 12px */
        gap: 8px; /* Reducido de 10px */
    }
    .modal-content .checkbox-group input[type="checkbox"] {
        width: 16px; /* Reducido de 20px */
        height: 16px; /* Reducido de 20px */
        margin: 0;
        accent-color: #0f0;
    }
    .modal-content .checkbox-group label {
        font-size: 0.88rem; /* Reducido de 1.1rem */
        color: #ddffdd;
    }

    /* Estilos para el Modal de Informaci√≥n */
    #infoModal .modal-content, #playerSelectModal .modal-content {
        max-width: 72%; /* Reducido de 90% */
        height: 72%; /* Reducido de 90% */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        padding: 20px; /* Reducido de 25px */
    }

    #infoModal .modal-content h2, #playerSelectModal .modal-content h2 {
        margin-bottom: 20px; /* Reducido de 25px */
    }

    #infoModal .info-columns, #playerSelectModal .player-list-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        width: 100%;
        flex-grow: 1;
        gap: 12px; /* Reducido de 15px */
        margin-bottom: 20px; /* Reducido de 25px */
    }

    #infoModal .info-column, #playerSelectModal .player-list-container .info-column {
        background: rgba(0, 50, 0, 0.8);
        border: 1px solid #0f0;
        border-radius: 8px; /* Reducido de 10px */
        padding: 16px; /* Reducido de 20px */
        flex: 1;
        min-width: 224px; /* Reducido de 280px */
        max-height: 100%;
        overflow-y: auto;
        box-shadow: 0 0 8px rgba(0, 255, 0, 0.5); /* Reducido de 10px */
        display: flex;
        flex-direction: column;
    }

    /* Estilo espec√≠fico para la columna de Rondas */
    #infoModal .info-column.rondas-info {
        min-width: 160px; /* Reducido de 200px */
        max-width: 200px; /* Reducido de 250px */
        flex-grow: 0;
        order: 100;
    }

    #infoModal .info-column h3, #playerSelectModal .player-list-container .info-column h3 {
        color: #0f0;
        text-align: center;
        margin-top: 0;
        margin-bottom: 10px; /* Reducido de 12px */
        font-size: 1.12rem; /* Reducido de 1.4rem */
        border-bottom: 1px solid rgba(0, 255, 0, 0.3);
        padding-bottom: 6px; /* Reducido de 8px */
    }

    #infoModal .info-column ul, #playerSelectModal .player-list-container .info-column ul {
        list-style: none;
        padding: 0;
        margin: 0;
        flex-grow: 1;
    }

    #infoModal .info-column li, #playerSelectModal .player-list-container .info-column li {
        margin-bottom: 6px; /* Reducido de 8px */
        font-size: 0.84rem; /* Reducido de 1.05rem */
        color: #ddffdd;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #infoModal .info-column li strong, #playerSelectModal .player-list-container .info-column li strong {
        color: #9ff7c9;
    }

    #infoModal .info-column li button, #playerSelectModal .player-list-container .info-column li button {
        background-color: #cc0000;
        font-size: 0.64rem; /* Reducido de 0.8rem */
        padding: 3px 6px; /* Reducido de 4px 8px */
        border: 1px solid #ff0000;
        margin-left: 8px; /* Reducido de 10px */
        border-radius: 4px; /* Reducido de 5px */
    }
    #infoModal .info-column li button:hover, #playerSelectModal .player-list-container .info-column li button:hover {
        background-color: #990000;
        box-shadow: 0 0 4px #ff0000; /* Reducido de 5px */
    }

    #infoModal .info-column .historial-item {
        border-bottom: 1px dashed rgba(0, 255, 0, 0.1);
        padding-bottom: 6px; /* Reducido de 8px */
        margin-bottom: 6px; /* Reducido de 8px */
    }
    #infoModal .info-column .historial-item:last-child {
        border-bottom: none;
    }
    #infoModal .info-column .historial-item em {
        color: #aaa;
    }
    #infoModal .info-column .historial-item .historial-num {
        font-weight: bold;
        color: #fff;
    }

    /* Estilos para la nueva columna de historial de apuestas */
    #infoModal .info-column.apuestas-historial {
        min-width: 280px; /* Reducido de 350px */
        order: 99;
    }
    #infoModal .info-column.apuestas-historial ul li {
        flex-direction: column;
        align-items: flex-start;
        padding: 4px 0; /* Reducido de 5px */
    }
    #infoModal .info-column.apuestas-historial ul li span {
        margin-bottom: 2px; /* Reducido de 3px */
        display: block;
    }
    #infoModal .info-column.apuestas-historial ul li .bet-details {
        font-size: 0.72em; /* Reducido de 0.9em */
        color: #ccc;
        display: block;
    }

    #infoModal .close-button, #playerSelectModal .close-button, #adminLoginModal .close-button {
        background-color: #cc0000;
        border: 2px solid #ff0000;
        width: auto;
        padding: 10px 20px; /* Reducido de 12px 25px */
        font-size: 0.96rem; /* Reducido de 1.2rem */
        margin-top: 20px; /* Reducido de 25px */
    }
    #infoModal .close-button:hover, #playerSelectModal .close-button:hover, #adminLoginModal .close-button:hover {
        background-color: #990000;
        box-shadow: 0 0 8px #ff0000; /* Reducido de 10px */
    }

    /* NUEVOS ESTILOS DEL REPRODUCTOR DE M√öSICA */
    .audio-panel-container {
        grid-area: reproductor;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 16px; /* Reducido de 20px */
        width: auto;
        height: auto;
    }

    .audio-panel {
      display: flex;
      flex-direction: column;
      gap: 16px; /* Reducido de 20px */
      padding: 16px; /* Reducido de 20px */
      border: 2px solid #0f0;
      border-radius: 10px; /* Reducido de 12px */
      background: rgba(0, 0, 0, 0.8);
      box-shadow: 0 0 16px rgba(0, 255, 0, 0.3); /* Reducido de 20px */
      max-width: 224px; /* Reducido de 280px */
      width: 100%;
    }

    .player-card {
      background: #000;
      border: 1px solid #0f0;
      border-radius: 6px; /* Reducido de 8px */
      padding: 12px; /* Reducido de 16px */
      box-shadow: inset 0 0 12px rgba(0, 255, 0, 0.2); /* Reducido de 15px */
    }

    .player-card h2 {
      margin-top: 0;
      margin-bottom: 11px; /* Reducido de 14px */
      font-size: 0.96rem; /* Reducido de 1.2rem */
      color: #0f0;
      text-shadow: 0 0 6px #0f0; /* Reducido de 8px */
    }

    .controls .audio-controls-group {
      display: flex;
      align-items: center;
      gap: 8px; /* Reducido de 10px */
      flex-wrap: wrap;
    }

    .controls .audio-controls-group button {
      background: #0a0;
      border: 1px solid #0f0;
      padding: 8px 11px; /* Reducido de 10px 14px */
      border-radius: 5px; /* Reducido de 6px */
      color: white;
      font-size: 0.8rem; /* Reducido de 1rem */
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 6px rgba(0,255,0,0.4); /* Reducido de 8px */
      transition: all 0.15s ease;
    }

    .controls .audio-controls-group button:hover {
      background-color: #0f0;
      color: #000;
      box-shadow: 0 0 12px #0f0; /* Reducido de 15px */
    }

    .controls .audio-controls-group label {
      font-size: 0.72rem; /* Reducido de 0.9rem */
      color: #0f0;
    }

    .controls .audio-controls-group input[type="range"] {
      flex: 1;
      min-width: 96px; /* Reducido de 120px */
      accent-color: #0f0;
    }

    .led-bar {
      height: 3px; /* Reducido de 4px */
      border-radius: 3px; /* Reducido de 4px */
      background: linear-gradient(90deg, #0f0, #050);
      margin-top: 10px; /* Reducido de 12px */
      box-shadow: 0 0 6px #0f0; /* Reducido de 8px */
      animation: pulse 2s infinite alternate;
    }

    @keyframes pulse {
      from { opacity: 0.6; }
      to { opacity: 1; }
    }

    /* Estilos para los botones de color */
    .color-buttons {
        display: flex;
        justify-content: space-around;
        margin-bottom: 8px; /* Reducido de 10px */
    }
    .color-buttons button {
        flex: 1;
        margin: 0 4px; /* Reducido de 5px */
        padding: 8px; /* Reducido de 10px */
        font-size: 0.88rem; /* Reducido de 1.1rem */
        font-weight: bold;
        border: 2px solid;
        border-radius: 6px; /* Reducido de 8px */
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .color-buttons button.red {
        background-color: #cc0000;
        border-color: #ff0000;
        color: white;
    }
    .color-buttons button.red:hover {
        background-color: #990000;
        box-shadow: 0 0 8px #ff0000; /* Reducido de 10px */
    }
    .color-buttons button.black {
        background-color: #333;
        border-color: #666;
        color: white;
    }
    .color-buttons button.black:hover {
        background-color: #000;
        box-shadow: 0 0 8px #666; /* Reducido de 10px */
    }
    .color-buttons button.green {
        background-color: #008000;
        border-color: #00ff00;
        color: white;
    }
    .color-buttons button.green:hover {
        background-color: #005500;
        box-shadow: 0 0 8px #00ff00; /* Reducido de 10px */
    }

    /* Estilo para el bot√≥n de seleccionar jugador */
    .select-player-button {
        background-color: #007bff;
        border-color: #007bff;
        color: white;
        margin-left: 8px; /* Reducido de 10px */
        flex-shrink: 0;
        width: auto;
    }
    .select-player-button:hover {
        background-color: #0056b3;
        box-shadow: 0 0 8px #007bff; /* Reducido de 10px */
    }

    /* Estilos para el modal de selecci√≥n de jugador */
    #playerSelectModal .player-list-container {
        display: flex;
        flex-direction: column;
        gap: 8px; /* Reducido de 10px */
        padding: 8px; /* Reducido de 10px */
        background: #002200;
        border-radius: 6px; /* Reducido de 8px */
        box-shadow: inset 0 0 8px #0a0; /* Reducido de 10px */
        max-height: 80%;
        overflow-y: auto;
    }
    #playerSelectModal .player-list-container ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    #playerSelectModal .player-list-container li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0; /* Reducido de 8px */
        border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        font-size: 0.88rem; /* Reducido de 1.1rem */
    }
    #playerSelectModal .player-list-container li:last-child {
        border-bottom: none;
    }
    #playerSelectModal .player-list-container li button {
        background-color: #00cc44;
        font-size: 0.72rem; /* Reducido de 0.9rem */
        padding: 4px 8px; /* Reducido de 5px 10px */
        border: 1px solid #0f0;
        margin-left: 8px; /* Reducido de 10px */
        border-radius: 4px; /* Reducido de 5px */
        width: auto;
    }
    #playerSelectModal .player-list-container li button:hover {
        background-color: #00bb33;
        box-shadow: 0 0 6px #0f0; /* Reducido de 8px */
    }

    /* Estilos para el grupo de input de nombre y bot√≥n de seleccionar jugador */
    .player-input-group {
        display: flex;
        align-items: center;
        gap: 8px; /* Reducido de 10px */
        margin-bottom: 10px; /* Reducido de 12px */
    }
    .player-input-group input {
        flex-grow: 1;
        margin-bottom: 0;
    }

    /* Estilos para el modal de inicio de sesi√≥n de admin */
    #adminLoginModal .modal-content {
        max-width: 400px; /* Reducido de 500px */
        padding: 24px; /* Reducido de 30px */
        border: 2px solid #00ff00; /* Reducido de 3px */
        box-shadow: 0 0 24px rgba(0, 255, 0, 0.7); /* Reducido de 30px */
        background: linear-gradient(145deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 20, 0.95));
    }
    #adminLoginModal .modal-content h2 {
        font-size: 2rem; /* Reducido de 2.5rem */
        color: #00ff00;
        text-shadow: 0 0 8px #00ff00; /* Reducido de 10px */
        margin-bottom: 20px; /* Reducido de 25px */
    }
    #adminLoginModal .modal-content input {
        background: #1a1a1a;
        border: 1px solid #00cc44;
        color: #ddffdd;
        font-size: 0.96rem; /* Reducido de 1.2rem */
        padding: 12px; /* Reducido de 15px */
        margin-bottom: 12px; /* Reducido de 15px */
        box-shadow: inset 0 0 6px rgba(0, 255, 0, 0.2); /* Reducido de 8px */
    }
    #adminLoginModal .modal-content input:focus {
        border-color: #00ff00;
        box-shadow: 0 0 12px rgba(0, 255, 0, 0.5); /* Reducido de 15px */
    }
    #adminLoginModal .modal-buttons {
        display: flex;
        justify-content: space-around;
        gap: 16px; /* Reducido de 20px */
        margin-top: 16px; /* Reducido de 20px */
    }
    #adminLoginModal .modal-buttons button {
        flex: 1;
        padding: 12px 20px; /* Reducido de 15px 25px */
        font-size: 1.12rem; /* Reducido de 1.4rem */
        font-weight: bold;
        border-radius: 6px; /* Reducido de 8px */
        transition: all 0.3s ease;
    }
    #adminLoginModal .modal-buttons button.accept {
        background-color: #00cc44;
        border-color: #00ff00;
    }
    #adminLoginModal .modal-buttons button.accept:hover {
        background-color: #00bb33;
        box-shadow: 0 0 16px #00ff00; /* Reducido de 20px */
    }
    #adminLoginModal .modal-buttons button.cancel {
        background-color: #cc0000;
        border-color: #ff0000;
    }
    #adminLoginModal .modal-buttons button.cancel:hover {
        background-color: #990000;
        box-shadow: 0 0 16px #ff0000; /* Reducido de 20px */
    }

  </style>
</head>
<body>

  <!-- Dock de Navegaci√≥n -->
  <nav class="dock">
    <a href="../index.html">Inicio</a>
    <a href="#" onclick="downloadSummary()">Descargar Resumen</a>
    <a href="#" onclick="showInfoModal()">Informaci√≥n</a>
  </nav>

  <!-- Modal de Configuraci√≥n Inicial -->
  <div id="configModal">
    <div class="modal-content">
      <h2>Configuraci√≥n de la Ruleta</h2>
      <p>Dinero inicial por jugador: <input type="number" id="initialMoney" placeholder="Ej: 10000" value="10000" /></p>
      <p>Apuesta m√≠nima: <input type="number" id="minBet" placeholder="Ej: 1000" value="1000" /></p>
      <p>N√∫mero de rondas: <input type="number" id="numRounds" placeholder="Ej: 5" value="5" /></p>
      <div class="checkbox-group">
        <input type="checkbox" id="enableSounds" checked />
        <label for="enableSounds">Activar sonidos al inicio</label>
      </div>
      <button onclick="applyInitialConfig()">Configurar Ruleta</button>
    </div>
  </div>

  <!-- Modal de Fin de Juego -->
  <div id="endGameModal">
    <div class="modal-content">
      <h2>¬°Fin de la Partida!</h2>
      <p id="endGameMessage">Has completado todas las rondas.</p>
      <button onclick="resetGame()">Empezar de Nuevo</button>
      <button onclick="continueGame()">Seguir Jugando</button>
      <button onclick="downloadSummary()">Descargar Resumen</button>
      <button onclick="window.location.href = '../index.html';">Salir</button>
    </div>
  </div>

  <!-- Modal de Informaci√≥n -->
  <div id="infoModal">
    <div class="modal-content">
      <h2>Informaci√≥n de la Partida</h2>
      <div class="info-columns">
        <div class="info-column">
          <h3>Jugadores</h3>
          <ul id="infoJugadoresList"></ul>
        </div>
        <div class="info-column">
          <h3>Historial de Resultados</h3>
          <ul id="infoHistorialResultados"></ul>
        </div>
        <!-- Nuevo panel para jugadores en la ronda actual -->
        <div class="info-column">
          <h3>Jugadores en esta ronda</h3>
          <ul id="infoListaJugadoresEnRonda">
              <!-- Aqu√≠ se listar√°n los jugadores que han apostado -->
          </ul>
        </div>
        <!-- Nueva columna para el historial de apuestas -->
        <div class="info-column apuestas-historial">
            <h3>Historial de Apuestas por Ronda</h3>
            <ul id="infoHistorialApuestas"></ul>
        </div>
        <div class="info-column rondas-info"> <!-- A√±adida clase rondas-info y movida al final -->
          <h3>Rondas</h3>
          <p>Ronda Actual: <strong id="infoCurrentRound">0</strong></p>
          <p>Rondas Totales: <strong id="infoTotalRounds">0</strong></p>
          <p>Rondas Restantes: <strong id="infoRemainingRounds">0</strong></p>
        </div>
      </div>
      <button class="close-button" onclick="closeInfoModal()">Cerrar</button>
    </div>
  </div>

  <!-- Modal de Selecci√≥n de Jugador -->
  <div id="playerSelectModal">
    <div class="modal-content">
      <h2>Seleccionar Jugador</h2>
      <div class="player-list-container">
        <ul id="playerSelectionList">
          <!-- Los jugadores se cargar√°n aqu√≠ din√°micamente -->
        </ul>
      </div>
      <button class="close-button" onclick="closePlayerSelectModal()">Cerrar</button>
    </div>
  </div>

  <!-- Modal de Inicio de Sesi√≥n de Admin -->
  <div id="adminLoginModal">
    <div class="modal-content">
      <h2>Acceso de Administrador</h2>
      <input type="text" id="adminUsername" placeholder="Usuario" />
      <input type="password" id="adminPassword" placeholder="Contrase√±a" />
      <div class="modal-buttons">
        <button class="accept" onclick="checkAdminLogin()">Aceptar</button>
        <button class="cancel" onclick="closeAdminLoginModal()">Volver</button>
      </div>
    </div>
  </div>

  <!-- üé° RULETA (Centro) - HTML DE RULETA2 -->
  <div class="wheel-frame" aria-hidden="true">
    <canvas id="ruletaCanvas" width="620" height="620"></canvas>
  </div>

  <!-- üí∏ APUESTAS (Columna Derecha) -->
  <div class="controls">
    <h2>Apuestas</h2>
    <div id="paymentInfo">
      <h3>Tabla de Pagos</h3>
      <p>
        <span class="red-text">Rojo</span> o <span class="black-text">Negro</span>: <span>2x</span><br>
        <span class="green-text">Verde (0)</span>: <span>36x</span><br>
        <span class="white-text">N√∫mero Exacto</span>: <span>36x</span>
      </p>
    </div>
    <div class="player-input-group">
        <input type="text" id="nombre" placeholder="Tu nombre" />
        <button class="select-player-button" onclick="showPlayerSelectModal()">Seleccionar Jugador</button>
    </div>
    <input type="number" id="dinero" placeholder="Cantidad a apostar" />
    <input type="text" id="apuesta" placeholder="rojo, negro, verde o n√∫mero" />

    <div class="color-buttons">
        <button class="red" onclick="selectBetType('rojo')">Rojo</button>
        <button class="black" onclick="selectBetType('negro')">Negro</button>
        <button class="green" onclick="selectBetType('verde')">Verde</button>
    </div>

    <div class="bet-spin-buttons"> <!-- Nuevo contenedor para los botones -->
        <button onclick="apostar()">Agregar Apuesta</button>
        <button onclick="girarRuleta()">Girar Ruleta</button>
    </div>

  </div>

  <!-- Nuevo Reproductor de M√∫sica (Integrado de copia 2 y movido) -->
  <div class="audio-panel-container">
    <div class="audio-panel">
      <!-- M√∫sica ambiente -->
      <section class="player-card">
        <h2>üé∂ M√∫sica de Ambiente</h2>
        <div class="controls audio-controls-group">
          <button id="musicPlay">‚ñ∂ Reproducir</button>
          <button id="musicPause">‚è∏ Pausar</button>
          <label for="musicVolume">Volumen:</label>
          <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="led-bar"></div>
      </section>

      <!-- Sonido ruleta -->
      <section class="player-card">
        <h2>üé∞ Sonido Ruleta</h2>
        <div class="controls audio-controls-group">
          <button id="spinPlay">üîä Reproducir</button>
          <button id="spinPause">‚è∏ Pausar</button>
          <label for="spinVolume">Volumen:</label>
          <input type="range" id="spinVolume" min="0" max="1" step="0.01" value="0.8">
        </div>
        <div class="led-bar"></div>
      </section>
    </div>
  </div>

  <!-- Archivos de audio para el nuevo reproductor -->
  <audio id="musicAudio" src="ambiente.mp3" loop></audio>
  <audio id="spinAudio" src="sonido_ruleta.mp3"></audio>

  <script>
    const canvas = document.getElementById("ruletaCanvas");
    const ctx = canvas.getContext("2d");
    const inputNombre = document.getElementById("nombre");
    const inputApuesta = document.getElementById("apuesta");
    const inputDinero = document.getElementById("dinero");

    // Elementos del modal de configuraci√≥n
    const configModal = document.getElementById("configModal");
    const initialMoneyInput = document.getElementById("initialMoney");
    const minBetInput = document.getElementById("minBet");
    const numRoundsInput = document.getElementById("numRounds");
    const enableSoundsCheckbox = document.getElementById("enableSounds"); // Nuevo checkbox

    // Elementos del modal de fin de juego
    const endGameModal = document.getElementById("endGameModal");
    const endGameMessage = document.getElementById("endGameMessage");

    // Elementos del modal de informaci√≥n
    const infoModal = document.getElementById("infoModal");
    const infoJugadoresList = document.getElementById("infoJugadoresList");
    const infoCurrentRound = document.getElementById("infoCurrentRound");
    const infoTotalRounds = document.getElementById("infoTotalRounds");
    const infoRemainingRounds = document.getElementById("infoRemainingRounds");
    const infoHistorialResultados = document.getElementById("infoHistorialResultados");
    const infoListaJugadoresEnRonda = document.getElementById("infoListaJugadoresEnRonda");
    const infoHistorialApuestas = document.getElementById("infoHistorialApuestas");

    // Elementos del modal de selecci√≥n de jugador
    const playerSelectModal = document.getElementById("playerSelectModal");
    const playerSelectionList = document.getElementById("playerSelectionList");

    // Elementos del modal de inicio de sesi√≥n de admin
    const adminLoginModal = document.getElementById("adminLoginModal");
    const adminUsernameInput = document.getElementById("adminUsername");
    const adminPasswordInput = document.getElementById("adminPassword");

    // Referencias a los elementos de audio y sus controles
    const musicAudio = document.getElementById("musicAudio");
    const spinAudio = document.getElementById("spinAudio");

    const musicPlayButton = document.getElementById("musicPlay");
    const musicPauseButton = document.getElementById("musicPause");
    const musicVolumeSlider = document.getElementById("musicVolume");

    const spinPlayButton = document.getElementById("spinPlay");
    const spinPauseButton = document.getElementById("spinPause");
    const spinVolumeSlider = document.getElementById("spinVolume");

    // Event Listeners para los botones de audio
    musicPlayButton.addEventListener("click", () => {
      musicAudio.volume = parseFloat(musicVolumeSlider.value);
      musicAudio.play().catch(err => console.log("Autoplay bloqueado:", err));
    });
    musicPauseButton.addEventListener("click", () => musicAudio.pause());
    musicVolumeSlider.addEventListener("input", (e) => {
      musicAudio.volume = parseFloat(e.target.value);
    });

    spinPlayButton.addEventListener("click", () => {
      spinAudio.volume = parseFloat(spinVolumeSlider.value);
      spinAudio.currentTime = 0; // Reinicia el sonido cada vez que se reproduce
      spinAudio.play().catch(err => console.log("Autoplay bloqueado:", err));
    });
    spinPauseButton.addEventListener("click", () => spinAudio.pause());
    spinVolumeSlider.addEventListener("input", (e) => {
      spinAudio.volume = parseFloat(e.target.value);
    });

    /* --- ESTADO DE LA RULETA --- */
    // Orden de los n√∫meros en una ruleta europea real (alternando rojo/negro, 0 verde)
    const ordenRuleta = [
      0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5,
      24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26
    ];

    // N√∫meros rojos en una ruleta europea
    const redNumbers = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];

    const numeros = ordenRuleta.map(n => {
      const color = n === 0 ? 'green' : (redNumbers.includes(n) ? 'red' : 'black');
      return { num: n, color };
    });

    let dineroJugador = {};
    let apuestas = [], yaApostaron = new Set();
    let retiredPlayers = new Set(); // Nuevo Set para jugadores retirados

    // Variables de animaci√≥n de la ruleta
    let currentAngle = 0;
    let bolaAngle = 0;
    let bolaRadialDistance = 0; // Variable para la distancia radial de la bola
    let animando = false;

    // Ajustar radios de la ruleta para el nuevo tama√±o (620px)
    // Estos valores se mantienen proporcionales al canvas de 620x620
    const outerBallTrackRadius = (canvas.width / 2) - 24; // Radio exterior de la pista de la bola
    const innerBallTrackRadius = 70 + 30; // Radio interior de la pista de la bola
    const finalBallSettleRadius = (canvas.width / 2) - 55; // Posici√≥n final de la bola

    // Variables de control de rondas y historial
    let initialPlayerMoney = 10000;
    let minimumBet = 1000;
    let totalRounds = 5;
    let currentRound = 0;
    let gameConfigured = false;
    let gameHistory = [];
    let gameStartTime = null;
    let enableSounds = true; // Variable para controlar si los sonidos est√°n activos

    /* --- RUTINAS DE DIBUJO --- */
    function drawRuleta(angle = 0) {
      const w = canvas.width, h = canvas.height;
      ctx.clearRect(0,0,w,h);
      const cx = w/2, cy = h/2;
      const radius = Math.min(w,h)/2 - 24;
      const slice = (2*Math.PI) / numeros.length;

      for (let i=0;i<numeros.length;i++) {
        const start = angle + i*slice;
        const end = start + slice;
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,radius,start,end);
        ctx.closePath();
        ctx.fillStyle = numeros[i].color === 'green' ? '#37d08a' : (numeros[i].color === 'red' ? '#d43b3b' : '#1b1b1b');
        ctx.fill();
        ctx.strokeStyle = '#463419';
        ctx.lineWidth = 2;
        ctx.stroke();

        // n√∫mero
        ctx.save();
        ctx.translate(cx,cy);
        ctx.rotate(start + slice/2);
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 18px Arial';
        ctx.textAlign = 'right';
        ctx.shadowColor = 'rgba(0,0,0,0.6)';
        ctx.shadowBlur = 6;
        ctx.fillText(String(numeros[i].num), radius - 18, 6);
        ctx.restore();
      }

      // c√≠rculo central
      ctx.beginPath();
      ctx.arc(cx,cy,70,0,2*Math.PI);
      const g = ctx.createRadialGradient(cx-10,cy-10,8,cx,cy,70);
      g.addColorStop(0,'#0b3c1f'); g.addColorStop(1,'#05120a');
      ctx.fillStyle = g;
      ctx.fill();
      ctx.strokeStyle = '#2f8a5a';
      ctx.lineWidth = 2;
      ctx.stroke();

      // bola
      const bx = cx + Math.cos(bolaAngle) * bolaRadialDistance;
      const by = cy + Math.sin(bolaAngle) * bolaRadialDistance;
      drawBall(bx,by);
    }

    function drawBall(x,y) {
      ctx.beginPath();
      ctx.arc(x,y,10,0,2*Math.PI);
      const g = ctx.createRadialGradient(x-3,y-3,1,x,y,10);
      g.addColorStop(0,'#fff'); g.addColorStop(1,'#cfcfcf');
      ctx.fillStyle = g;
      ctx.fill();
      ctx.strokeStyle = '#888';
      ctx.stroke();
      ctx.shadowBlur = 12;
      ctx.shadowColor = '#fff';
    }

    function actualizarJugadoresEnRonda() {
        infoListaJugadoresEnRonda.innerHTML = ""; // Usar el elemento en el modal de informaci√≥n
        if (yaApostaron.size === 0) {
            infoListaJugadoresEnRonda.innerHTML = "<li>Nadie ha apostado a√∫n.</li>";
            return;
        }
        yaApostaron.forEach(nombreJugador => {
            const li = document.createElement("li");
            const apuestaJugador = apuestas.find(a => a.nombre === nombreJugador);
            if (apuestaJugador) {
                li.innerHTML = `
                    <span>${nombreJugador} (${apuestaJugador.apuesta.toUpperCase()} $${apuestaJugador.monto})</span>
                    <button onclick="cancelarApuesta('${nombreJugador}')">Cancelar</button>
                `;
                infoListaJugadoresEnRonda.appendChild(li);
            }
        });
    }

    function apostar() {
      if (!gameConfigured) {
          alert("Por favor, configura el juego primero.");
          return;
      }
      if (animando) {
          alert("No puedes apostar mientras la ruleta est√° girando.");
          return;
      }

      const nombre = inputNombre.value.trim();
      const monto = parseInt(inputDinero.value);
      const validNumbers = numeros.map(n=>String(n.num));
      const validos = ['rojo','negro','verde', ...validNumbers];
      const apuesta = inputApuesta.value.trim().toLowerCase();

      if (retiredPlayers.has(nombre)) {
          alert(`${nombre} se ha retirado del juego y no puede apostar.`);
          return;
      }

      if (!nombre || !apuesta || isNaN(monto) || !validos.includes(apuesta)) {
        return alert("Datos inv√°lidos. Aseg√∫rate de rellenar todos los campos y que la apuesta sea v√°lida (rojo, negro, verde o un n√∫mero).");
      }
      if (monto < minimumBet) {
        return alert(`La apuesta m√≠nima es de ${minimumBet} monedas.`);
      }

      if (!dineroJugador[nombre]) {
          dineroJugador[nombre] = initialPlayerMoney;
      }

      if (yaApostaron.has(nombre)) {
          return alert("Ya apostaste en esta ronda. Solo se permite una apuesta por jugador por ronda.");
      }
      if (dineroJugador[nombre] < monto) {
          return alert("Dinero insuficiente.");
      }

      dineroJugador[nombre] -= monto;
      apuestas.push({ nombre, apuesta, monto });
      yaApostaron.add(nombre);
      inputNombre.value = inputApuesta.value = inputDinero.value = "";
      // No es necesario un alert aqu√≠, la informaci√≥n se actualizar√° en el modal
      actualizarJugadoresEnRonda();
    }

    function cancelarApuesta(nombreJugador) {
        if (animando) {
            alert("No puedes cancelar apuestas mientras la ruleta est√° girando.");
            return;
        }
        // Buscar la apuesta en la lista de apuestas
        const index = apuestas.findIndex(a => a.nombre === nombreJugador);
        if (index > -1) {
            const apuestaCancelada = apuestas[index];
            dineroJugador[nombreJugador] += apuestaCancelada.monto;
            apuestas.splice(index, 1); // Eliminar la apuesta del array
            yaApostaron.delete(nombreJugador); // Eliminar del Set de jugadores que ya apostaron

            alert(`Apuesta de ${nombreJugador} cancelada. Se le devolvieron $${apuestaCancelada.monto}.`);
            // No es necesario un alert aqu√≠, la informaci√≥n se actualizar√° en el modal
            actualizarJugadoresEnRonda();
        } else {
            alert("Este jugador no tiene una apuesta activa para cancelar.");
        }
    }

    function removePlayer(playerName) {
        if (confirm(`¬øEst√°s seguro de que quieres eliminar a ${playerName} del juego? Su dinero actual ($${dineroJugador[playerName]}) se perder√°.`)) {
            // Registrar el retiro del jugador
            retiredPlayers.add(playerName);
            gameHistory.push({
                round: currentRound + 1,
                event: 'player_retired',
                playerName: playerName,
                moneyAtRetirement: dineroJugador[playerName]
            });

            // Eliminar al jugador de las apuestas activas si las tiene
            if (yaApostaron.has(playerName)) {
                const apuestaCancelada = apuestas.find(a => a.nombre === playerName);
                if (apuestaCancelada) {
                    // No se devuelve el dinero, se considera perdido al retirarse
                    apuestas = apuestas.filter(a => a.nombre !== playerName);
                    yaApostaron.delete(playerName);
                }
            }

            // Eliminar al jugador de la lista de dineroJugador
            delete dineroJugador[playerName];

            alert(`${playerName} ha sido eliminado del juego.`);
            updateInfoModalContent(); // Actualizar la lista de jugadores en el modal de informaci√≥n
            actualizarJugadoresEnRonda(); // Por si estaba en la lista de jugadores en ronda
        }
    }

    /* --- GIRAR RULETA y c√°lculo de ganador --- */
    function girarRuleta(isTestSpin = false) { // A√±adido par√°metro para giros de prueba
      if (!gameConfigured && !isTestSpin) { alert('Configura la partida primero.'); return; }
      if (animando) return;
      if (apuestas.length===0 && !isTestSpin) { alert('No hay apuestas.'); return; }

      const roundObj = {
        round: currentRound + 1,
        initialPlayerBalances: {...dineroJugador},
        bets: JSON.parse(JSON.stringify(apuestas)), // Guardar las apuestas de esta ronda
        result: null,
        winners: [],
        finalPlayerBalances: null,
        retiredPlayersInRound: [...retiredPlayers], // Registrar jugadores retirados en esta ronda
        isTest: isTestSpin // Marcar si es un giro de prueba
      };
      gameHistory.push(roundObj);

      if (enableSounds) { // Solo reproducir si los sonidos est√°n activados
        spinAudio.volume = parseFloat(spinVolumeSlider.value || 0.8);
        spinAudio.play().catch(()=>{ /* ignore */ });
      }


      const minVueltasRuleta = 5;
      const minVueltasBola = 10;

      const randomAddVueltasRuleta = Math.random() * 5;
      const randomAddVueltasBola = Math.random() * 8;

      const totalVueltasRuleta = minVueltasRuleta + randomAddVueltasRuleta;
      const totalVueltasBola = minVueltasBola + randomAddVueltasBola;

      const finalRotationRuleta = currentAngle + (totalVueltasRuleta * 2 * Math.PI);
      const finalRotationBola = bolaAngle + (totalVueltasBola * 2 * Math.PI);

      const duracionAnimacion = 8000;

      const initialAngleRuleta = currentAngle;
      const initialAngleBola = bolaAngle;
      const initialRadialDistanceBola = outerBallTrackRadius;

      animando = true;
      let start = null;

      const easeOutCubic = x => 1 - Math.pow(1 - x, 3);
      const easeInQuad = x => x * x;

      function animar(ts) {
        if (!start) start = ts;
        const t = ts - start;
        const prog = Math.min(t / duracionAnimacion, 1);

        const easedProg = easeOutCubic(prog);

        currentAngle = initialAngleRuleta + (finalRotationRuleta - initialAngleRuleta) * easedProg;
        bolaAngle = initialAngleBola + (finalRotationBola - initialAngleBola) * easedProg;

        bolaRadialDistance = initialRadialDistanceBola + (finalBallSettleRadius - initialRadialDistanceBola) * easeInQuad(prog);

        const oscillationAmplitude = 10 * (1 - prog);
        const oscillationFrequency = 20;
        bolaRadialDistance += Math.sin(prog * Math.PI * oscillationFrequency) * oscillationAmplitude;

        bolaRadialDistance = Math.max(bolaRadialDistance, innerBallTrackRadius);

        drawRuleta(currentAngle);

        if (prog < 1) {
          requestAnimationFrame(animar);
        } else {
          animando = false;
          if (enableSounds) { // Solo pausar si los sonidos est√°n activados
            spinAudio.pause();
            spinAudio.currentTime = 0;
          }


          currentAngle = currentAngle % (2 * Math.PI);
          bolaAngle = bolaAngle % (2 * Math.PI);
          bolaRadialDistance = finalBallSettleRadius;

          drawRuleta(currentAngle);

          const slice = (2 * Math.PI) / numeros.length;
          let winnerIndex = -1;

          // Calcular el √°ngulo relativo de la bola respecto a la ruleta
          let finalRelativeAngle = (bolaAngle - currentAngle);
          // Normalizar el √°ngulo para que est√© entre 0 y 2*PI
          finalRelativeAngle = finalRelativeAngle % (2 * Math.PI);
          if (finalRelativeAngle < 0) {
              finalRelativeAngle += (2 * Math.PI);
          }

          // Determinar el √≠ndice del n√∫mero ganador
          winnerIndex = Math.floor(finalRelativeAngle / slice);

          // Asegurarse de que el √≠ndice est√© dentro de los l√≠mites del array de n√∫meros
          if (winnerIndex < 0 || winnerIndex >= numeros.length) {
              winnerIndex = 0; // Fallback, aunque no deber√≠a ocurrir con la normalizaci√≥n
          }

          const winner = numeros[winnerIndex];
          procesarResultado(winner, isTestSpin); // Pasar isTestSpin a procesarResultado
        }
      }
      requestAnimationFrame(animar);
    }

    function procesarResultado(winner, isTestSpin = false) { // A√±adido par√°metro
      // Obtener el color del n√∫mero ganador directamente del objeto 'winner'
      const colorEsp = winner.color === 'red' ? 'rojo' : (winner.color === 'black' ? 'negro' : 'verde');
      let hubo = false;
      let winnersRound = [];

      if (!isTestSpin) { // Solo procesar apuestas si no es un giro de prueba
        apuestas.forEach(a=>{
          let premio = 0;

          // 1. Apuesta a n√∫mero exacto
          if (a.apuesta === String(winner.num)) {
            premio = a.monto * 36;
          }
          // 2. Apuesta a color (rojo/negro) - SOLO si el n√∫mero ganador NO es 0
          else if (winner.num !== 0) {
              if ((a.apuesta === 'rojo' && winner.color === 'red') ||
                  (a.apuesta === 'negro' && winner.color === 'black')) {
                  premio = a.monto * 2;
              }
          }
          // 3. Apuesta a verde (solo si el n√∫mero ganador es 0)
          else if (winner.num === 0 && a.apuesta === 'verde') {
              premio = a.monto * 36; // El 0 paga 36x
          }

          if (premio > 0) {
            dineroJugador[a.nombre] = (dineroJugador[a.nombre] || 0) + premio;
            winnersRound.push({ name: a.nombre, winnings: premio });
            hubo = true;
          }
        });
      }

      const last = gameHistory[gameHistory.length - 1];
      if (last) {
        last.result = { num: winner.num, color: colorEsp }; // Usar colorEsp aqu√≠
        last.winners = winnersRound;
        last.finalPlayerBalances = { ...dineroJugador };
      }

      if (!isTestSpin) { // Limpiar apuestas solo si no es un giro de prueba
        apuestas = [];
        yaApostaron.clear();
        currentRound++;
      }

      // No es necesario un alert aqu√≠, la informaci√≥n se actualizar√° en el modal
      actualizarJugadoresEnRonda();
      updateInfoModalContent(); // Actualizar el modal de informaci√≥n despu√©s de cada giro

      if (currentRound >= totalRounds && !isTestSpin) {
        setTimeout(()=> {
          showEndGameModal();
        }, 600);
      }
    }

    function showConfigModal() {
        configModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function applyInitialConfig() {
        const newInitialMoney = parseInt(initialMoneyInput.value);
        const newMinBet = parseInt(minBetInput.value);
        const newNumRounds = parseInt(numRoundsInput.value);
        enableSounds = enableSoundsCheckbox.checked; // Obtener el estado del checkbox

        if (isNaN(newInitialMoney) || newInitialMoney <= 0) {
            alert("Por favor, introduce una cantidad v√°lida para el dinero inicial (mayor que 0).");
            return;
        }
        if (isNaN(newMinBet) || newMinBet <= 0) {
            alert("Por favor, introduce una cantidad v√°lida para la apuesta m√≠nima (mayor que 0).");
            return;
        }
        if (isNaN(newNumRounds) || newNumRounds <= 0) {
            alert("Por favor, introduce un n√∫mero v√°lido de rondas (mayor que 0).");
            return;
        }

        initialPlayerMoney = newInitialMoney;
        minimumBet = newMinBet;
        totalRounds = newNumRounds;
        currentRound = 0;
        gameHistory = [];
        dineroJugador = {};
        retiredPlayers.clear(); // Limpiar jugadores retirados al iniciar nueva partida
        gameStartTime = new Date();

        gameConfigured = true;

        configModal.style.display = 'none';
        document.body.style.overflow = '';

        // Inicializar la posici√≥n de la bola y la ruleta
        currentAngle = 0;
        bolaAngle = 0;
        bolaRadialDistance = outerBallTrackRadius; // La bola empieza en el exterior

        drawRuleta();
        // No es necesario un alert aqu√≠, la informaci√≥n se actualizar√° en el modal
        actualizarJugadoresEnRonda();

        // Si los sonidos est√°n activados, intentar reproducirlos
        if (enableSounds) {
            musicAudio.volume = parseFloat(musicVolumeSlider.value);
            musicAudio.play().catch(err => console.log("Autoplay de m√∫sica ambiente bloqueado:", err));
            spinAudio.volume = parseFloat(spinVolumeSlider.value); // Ajustar volumen, pero no reproducir a√∫n
            spinAudio.pause(); // Asegurarse de que no se reproduzca hasta que se gire la ruleta
        } else {
            musicAudio.pause();
            spinAudio.pause();
        }
    }

    function showEndGameModal() {
        endGameMessage.textContent = `¬°Has completado las ${totalRounds} rondas!`;
        endGameModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function resetGame() {
        endGameModal.style.display = 'none';
        document.body.style.overflow = '';
        showConfigModal();
    }

    function continueGame() {
        endGameModal.style.display = 'none';
        document.body.style.overflow = '';
        totalRounds += 5;
        alert(`¬°Has decidido seguir jugando! Se han a√±adido 5 rondas m√°s. Total de rondas: ${totalRounds}`);
    }

    function downloadSummary() {
        const endTime = new Date();
        let summaryContent = `
================================================================================
                        RESUMEN DE PARTIDA DE RULETA CASINO
================================================================================

--------------------------------------------------------------------------------
INFORMACI√ìN GENERAL DE LA PARTIDA
--------------------------------------------------------------------------------
Fecha de Inicio: ${gameStartTime ? gameStartTime.toLocaleString('es-ES', { dateStyle: 'full', timeStyle: 'medium' }) : 'N/A'}
Fecha de Fin:    ${endTime.toLocaleString('es-ES', { dateStyle: 'full', timeStyle: 'medium' })}
Duraci√≥n Total:  ${gameStartTime ? formatDuration(endTime - gameStartTime) : 'N/A'}

Configuraci√≥n Inicial:
  Dinero Inicial por Jugador: $${initialPlayerMoney}
  Apuesta M√≠nima:             $${minimumBet}
  Rondas Configuradas:        ${totalRounds}
  Rondas Jugadas Completadas: ${currentRound}

--------------------------------------------------------------------------------
SALDOS FINALES Y RESULTADOS NETOS DE JUGADORES
--------------------------------------------------------------------------------
`;

        const allPlayers = new Set([...Object.keys(dineroJugador), ...Array.from(retiredPlayers)]);
        const playerNetResults = {};
        let overallWinner = { name: 'N/A', money: -Infinity };
        let overallLoser = { name: 'N/A', money: Infinity };
        let totalMoneyInPlay = 0;
        let totalMoneyWonByPlayers = 0;
        let totalMoneyLostByPlayers = 0;

        if (allPlayers.size === 0) {
            summaryContent += "No hubo jugadores registrados en esta partida.\n";
        } else {
            summaryContent += "Jugadores Activos al Final:\n";
            if (Object.keys(dineroJugador).length === 0) {
                summaryContent += "  Ninguno.\n";
            } else {
                for (const player in dineroJugador) {
                    const netChange = dineroJugador[player] - initialPlayerMoney;
                    playerNetResults[player] = netChange;
                    totalMoneyInPlay += dineroJugador[player];

                    if (dineroJugador[player] > overallWinner.money) {
                        overallWinner = { name: player, money: dineroJugador[player] };
                    }
                    if (dineroJugador[player] < overallLoser.money) {
                        overallLoser = { name: player, money: dineroJugador[player] };
                    }

                    summaryContent += `  - ${player}: Saldo Final $${dineroJugador[player]} (Neto: ${netChange >= 0 ? '+' : ''}$${netChange})\n`;
                    if (netChange > 0) totalMoneyWonByPlayers += netChange;
                    else totalMoneyLostByPlayers += Math.abs(netChange);
                }
            }

            summaryContent += "\nJugadores Retirados Durante la Partida:\n";
            if (retiredPlayers.size === 0) {
                summaryContent += "  Ninguno.\n";
            } else {
                retiredPlayers.forEach(player => {
                    const retirementEvent = gameHistory.find(entry => entry.event === 'player_retired' && entry.playerName === player);
                    const moneyAtRetirement = retirementEvent ? retirementEvent.moneyAtRetirement : 'Desconocido';
                    const roundRetired = retirementEvent ? retirementEvent.round : 'Desconocida';
                    summaryContent += `  - ${player}: Se retir√≥ en Ronda ${roundRetired} con $${moneyAtRetirement}.\n`;
                    // Considerar el dinero inicial como perdido si se retir√≥ con menos
                    if (retirementEvent && moneyAtRetirement < initialPlayerMoney) {
                        totalMoneyLostByPlayers += (initialPlayerMoney - moneyAtRetirement);
                    }
                });
            }

            summaryContent += "\nAn√°lisis de Ganancias/P√©rdidas Netas:\n";
            if (Object.keys(dineroJugador).length > 0) {
                summaryContent += `  Mayor Ganador (Activo): ${overallWinner.name} con $${overallWinner.money} (Ganancia neta: ${playerNetResults[overallWinner.name] >= 0 ? '+' : ''}$${playerNetResults[overallWinner.name]})\n`;
                summaryContent += `  Mayor Perdedor (Activo): ${overallLoser.name} con $${overallLoser.money} (P√©rdida neta: ${playerNetResults[overallLoser.name] >= 0 ? '+' : ''}$${playerNetResults[overallLoser.name]})\n`;
            }
            summaryContent += `  Total Ganado por Jugadores Activos: $${totalMoneyWonByPlayers}\n`;
            summaryContent += `  Total Perdido por Jugadores Activos: $${totalMoneyLostByPlayers}\n`;
            summaryContent += `  Balance General de la Casa: ${totalMoneyLostByPlayers - totalMoneyWonByPlayers >= 0 ? '+' : ''}$${totalMoneyLostByPlayers - totalMoneyWonByPlayers}\n`;
        }


        summaryContent += `
--------------------------------------------------------------------------------
HISTORIAL DETALLADO DE RONDAS
--------------------------------------------------------------------------------
`;
        if (gameHistory.length === 0) {
            summaryContent += "No se jug√≥ ninguna ronda.\n";
        } else {
            gameHistory.forEach(round => {
                if (round.event === 'player_retired') {
                    summaryContent += `\n--- Ronda ${round.round} - Evento: Retiro de Jugador ---\n`;
                    summaryContent += `  Jugador: ${round.playerName}\n`;
                    summaryContent += `  Dinero al Retirarse: $${round.moneyAtRetirement}.\n`;
                } else {
                    summaryContent += `\n--- Ronda ${round.round} ${round.isTest ? '(GIRO DE PRUEBA)' : ''} ---\n`;
                    summaryContent += `  Saldos Iniciales de Jugadores:\n`;
                    for (const player in round.initialPlayerBalances) {
                        summaryContent += `    - ${player}: $${round.initialPlayerBalances[player]}\n`;
                    }
                    summaryContent += `  Apuestas Realizadas:\n`;
                    if (round.bets.length === 0) {
                        summaryContent += `    Ninguna.\n`;
                    } else {
                        round.bets.forEach(bet => {
                            summaryContent += `    - ${bet.nombre} apost√≥ $${bet.monto} a ${bet.apuesta.toUpperCase()}\n`;
                        });
                    }
                    summaryContent += `  Resultado del Giro: ${round.result ? `${round.result.num} (${round.result.color.toUpperCase()})` : 'N/A'}\n`;
                    summaryContent += `  Ganadores de la Ronda:\n`;
                    if (round.winners.length === 0) {
                        summaryContent += `    No hubo ganadores en esta ronda.\n`;
                    } else {
                        round.winners.forEach(winner => {
                            summaryContent += `    - ${winner.name} gan√≥ $${winner.winnings}\n`;
                        });
                    }
                    summaryContent += `  Saldos Finales de Jugadores en la Ronda:\n`;
                    for (const player in round.finalPlayerBalances) {
                        summaryContent += `    - ${player}: $${round.finalPlayerBalances[player]}\n`;
                    }
                }
            });
        }

        summaryContent += `
================================================================================
                            FIN DEL RESUMEN
================================================================================
`;

        const formattedDate = gameStartTime ? gameStartTime.toLocaleDateString('es-ES', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '-') : 'FechaDesconocida';
        const formattedTime = gameStartTime ? gameStartTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' }).replace(/:/g, '-') : 'HoraDesconocida';
        const fileName = `Ruleta Casino - Resumen ${formattedDate} ${formattedTime}.txt`;

        const blob = new Blob([summaryContent], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        alert("Resumen de la partida descargado.");
    }

    // Funci√≥n auxiliar para formatear la duraci√≥n
    function formatDuration(ms) {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);

        let result = [];
        if (days > 0) result.push(`${days} d√≠a${days > 1 ? 's' : ''}`);
        if (hours % 24 > 0) result.push(`${hours % 24} hora${hours % 24 > 1 ? 's' : ''}`);
        if (minutes % 60 > 0) result.push(`${minutes % 60} minuto${minutes % 60 > 1 ? 's' : ''}`);
        if (seconds % 60 > 0 || result.length === 0) result.push(`${seconds % 60} segundo${seconds % 60 > 1 ? 's' : ''}`);

        return result.join(', ');
    }


    // Funciones para el modal de informaci√≥n
    function showInfoModal() {
        updateInfoModalContent();
        infoModal.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Evita el scroll del body
    }

    function closeInfoModal() {
        infoModal.style.display = 'none';
        document.body.style.overflow = ''; // Restaura el scroll del body
    }

    function updateInfoModalContent() {
        // Actualizar Jugadores
        infoJugadoresList.innerHTML = "";
        if (Object.keys(dineroJugador).length === 0) {
            infoJugadoresList.innerHTML = "<li>No hay jugadores activos.</li>";
        } else {
            for (const playerName in dineroJugador) {
                const li = document.createElement("li");
                li.innerHTML = `
                    <span>${playerName}: <strong>$${dineroJugador[playerName]}</strong></span>
                    <button onclick="removePlayer('${playerName}')">Eliminar</button>
                `;
                infoJugadoresList.appendChild(li);
            }
        }

        // Actualizar Rondas
        infoCurrentRound.textContent = currentRound;
        infoTotalRounds.textContent = totalRounds;
        infoRemainingRounds.textContent = Math.max(totalRounds - currentRound, 0);

        // REPROGRAMACI√ìN DEL HISTORIAL DE RESULTADOS
        infoHistorialResultados.innerHTML = "";
        if (gameHistory.length === 0) {
            infoHistorialResultados.innerHTML = "<li>No se ha jugado ninguna ronda.</li>";
        } else {
            // Iterar sobre el historial de juego en orden inverso para mostrar lo m√°s reciente primero
            for (let i = gameHistory.length - 1; i >= 0; i--) {
                const round = gameHistory[i];
                const li = document.createElement("li");
                li.classList.add("historial-item");

                if (round.event === 'player_retired') {
                    li.innerHTML = `
                        <strong>Ronda ${round.round}:</strong>
                        <em>${round.playerName} se retir√≥ con $${round.moneyAtRetirement}.</em>
                    `;
                } else {
                    // Asegurarse de que round.result exista antes de acceder a sus propiedades
                    const resultNum = round.result ? round.result.num : 'N/A';
                    const resultColor = round.result ? round.result.color : 'N/A'; // 'rojo', 'negro', 'verde'

                    let colorClass = '';
                    let colorText = '';

                    if (resultColor === 'rojo') {
                        colorClass = 'red-text';
                        colorText = 'ROJO';
                    } else if (resultColor === 'negro') {
                        colorClass = 'black-text';
                        colorText = 'NEGRO';
                    } else if (resultColor === 'verde') {
                        colorClass = 'green-text';
                        colorText = 'VERDE';
                    } else {
                        colorClass = 'white-text'; // Default para 'N/A' o inesperado
                        colorText = 'N/A';
                    }

                    const testSpinLabel = round.isTest ? '(E)' : ''; // Etiqueta "(E)" para giros de prueba

                    const winnersHtml = round.winners.length > 0
                        ? round.winners.map(w => `${w.name} ($${w.winnings})`).join(', ')
                        : '<em>No hubo ganadores.</em>';

                    // Nuevo formato: Ronda x: n¬∫ color n¬∫ ganadores
                    li.innerHTML = `
                        <strong>Ronda ${round.round}${testSpinLabel}:</strong> ${resultNum} <span class="${colorClass}">${colorText}</span> - Ganadores: ${winnersHtml}
                    `;
                }
                infoHistorialResultados.appendChild(li); // A√±adir al final para que el bucle inverso lo ponga en orden correcto
            }
        }

        // Actualizar Jugadores en esta ronda (en el modal de informaci√≥n)
        actualizarJugadoresEnRonda();

        // Actualizar Historial de Apuestas por Ronda (VERTICAL)
        infoHistorialApuestas.innerHTML = "";
        if (gameHistory.length === 0) {
            infoHistorialApuestas.innerHTML = "<li>No se han registrado apuestas.</li>";
        } else {
            // Iterar sobre el historial de juego en orden inverso para mostrar lo m√°s reciente primero
            for (let i = gameHistory.length - 1; i >= 0; i--) {
                const round = gameHistory[i];
                // Solo mostrar rondas que no son de prueba y tienen apuestas
                if (!round.isTest && round.bets && round.bets.length > 0) {
                    const li = document.createElement("li");
                    li.innerHTML = `<strong>Ronda ${round.round}:</strong>`;
                    round.bets.forEach(bet => {
                        const betDetail = document.createElement("div"); // Usar div para asegurar bloque
                        betDetail.classList.add("bet-details");
                        betDetail.innerHTML = `&nbsp;&nbsp;${bet.nombre} apost√≥ $${bet.monto} a ${bet.apuesta.toUpperCase()}`;
                        li.appendChild(betDetail);
                    });
                    infoHistorialApuestas.appendChild(li); // A√±adir al final para que el bucle inverso lo ponga en orden correcto
                }
            }
        }
    }

    // Funciones para el modal de selecci√≥n de jugador
    function showPlayerSelectModal() {
        playerSelectionList.innerHTML = "";
        if (Object.keys(dineroJugador).length === 0) {
            playerSelectionList.innerHTML = "<li>No hay jugadores activos.</li>";
        } else {
            for (const playerName in dineroJugador) {
                if (!retiredPlayers.has(playerName)) { // Solo mostrar jugadores no retirados
                    const li = document.createElement("li");
                    li.innerHTML = `
                        <span>${playerName}: <strong>$${dineroJugador[playerName]}</strong></span>
                        <button onclick="selectPlayer('${playerName}')">Seleccionar</button>
                    `;
                    playerSelectionList.appendChild(li);
                }
            }
        }
        playerSelectModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closePlayerSelectModal() {
        playerSelectModal.style.display = 'none';
        document.body.style.overflow = '';
    }

    function selectPlayer(playerName) {
        inputNombre.value = playerName;
        inputDinero.value = minimumBet; // Cantidad por defecto
        closePlayerSelectModal();
    }

    function selectBetType(type) {
        inputApuesta.value = type;
    }

    // NUEVA FUNCIONALIDAD: Giro de prueba de la ruleta y login de admin
    canvas.addEventListener('click', function(event) {
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));

        // Detectar clic en el centro de la ruleta (aproximadamente el c√≠rculo central)
        if (distance < 70) { // 70 es el radio del c√≠rculo central
            showAdminLoginModal();
        }
    });

    function showAdminLoginModal() {
        adminLoginModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        adminUsernameInput.value = ''; // Limpiar campos
        adminPasswordInput.value = '';
        adminUsernameInput.focus(); // Poner el foco en el campo de usuario
    }

    function closeAdminLoginModal() {
        adminLoginModal.style.display = 'none';
        document.body.style.overflow = '';
    }

    function checkAdminLogin() {
        const username = adminUsernameInput.value;
        const password = adminPasswordInput.value;

        if (username === "admin" && password === "1234") {
            closeAdminLoginModal();
            girarRuleta(true); // Llamar a girarRuleta con isTestSpin = true
        } else {
            alert("Credenciales incorrectas. No se puede iniciar el giro de prueba.");
            adminPasswordInput.value = ''; // Limpiar solo la contrase√±a
            adminUsernameInput.focus(); // Volver a poner el foco en el usuario
        }
    }

    // Funci√≥n para inicializar el audio al cargar la p√°gina
    function initializeAudio() {
        // Intentar reproducir la m√∫sica de ambiente si enableSounds es true
        if (enableSounds) {
            musicAudio.volume = parseFloat(musicVolumeSlider.value);
            musicAudio.play().catch(err => console.log("Autoplay de m√∫sica ambiente bloqueado:", err));
            // El sonido de la ruleta no se reproduce autom√°ticamente, solo se ajusta el volumen
            spinAudio.volume = parseFloat(spinVolumeSlider.value);
            spinAudio.pause(); // Asegurarse de que no se reproduzca hasta que se gire la ruleta
        } else {
            musicAudio.pause();
            spinAudio.pause();
        }
    }

    // Modificar window.onload para que solo muestre el modal de configuraci√≥n y luego inicialice el audio
    window.onload = () => {
        showConfigModal();
        drawRuleta(); // Dibujar la ruleta al inicio
        // La inicializaci√≥n de audio se mover√° a applyInitialConfig para respetar el checkbox
    };
  </script>
</body>
</html>
