<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ruleta Casino</title>
  <link rel="icon" href="../pikachu.png" type="image/png">
  <style>
    /* Estilos Generales y Reseteo */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 10px;
      background: radial-gradient(circle at center, #1b1b1b, #0f0f0f);
      color: white; font-family: 'Segoe UI', sans-serif;
      display: grid;
      /* Definici√≥n de la cuadr√≠cula principal */
      /* Una columna para la m√∫sica, una columna para la ruleta, una columna para las apuestas */
      grid-template-columns: 1fr auto 1fr; /* Ajuste din√°mico para centrar la ruleta */
      grid-template-rows: auto 1fr; /* Filas: Dock, Contenido principal */
      grid-template-areas:
        "dock dock dock"
        "reproductor ruleta apuestas"; /* M√∫sica a la izquierda, Ruleta en el centro, Apuestas a la derecha */
      gap: 20px; /* Aumentado el espacio entre elementos de la cuadr√≠cula para margen con ruleta */
      min-height: 100vh; /* Ocupar toda la altura de la ventana */
      overflow: hidden; /* Evitar scroll general de la p√°gina */
    }

    /* Estilos para el Dock de Navegaci√≥n */
    .dock {
      grid-area: dock;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 20px;
      border-radius: 0 0 10px 10px;
      display: flex;
      justify-content: center;
      gap: 30px;
      box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
      margin-bottom: 10px;
    }
    .dock a {
      color: #0f0;
      text-decoration: none;
      font-size: 1.2rem;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 5px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .dock a:hover {
      background-color: #00cc44;
      color: #fff;
      box-shadow: 0 0 10px #0f0;
    }

    /* Estilos para el Canvas de la Ruleta */
    .wheel-frame {
      grid-area: ruleta; /* Asignar al √°rea 'ruleta' en la cuadr√≠cula */
      padding: 18px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 50% 40%, #ffe8d0, #cfa07a 35%, #6f4a2b 70%),
        linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.2));
      box-shadow: 0 14px 40px rgba(0,0,0,0.6), inset 0 8px 24px rgba(255,255,255,0.03);
      display: flex; /* Usar flexbox para centrar */
      justify-content: center; /* Centrar horizontalmente */
      align-items: center; /* Centrar verticalmente */
      margin: auto; /* Centrar el contenedor dentro de su celda */
      /* Ajuste de tama√±o para que la ruleta se ajuste al espacio disponible */
      max-width: 100%;
      max-height: 100%;
    }
    canvas#ruletaCanvas {
      background: transparent;
      display:block;
      /* Ajustar el tama√±o del canvas para que sea responsivo */
      max-width: 700px; /* Aumentado el tama√±o m√°ximo */
      max-height: 700px; /* Aumentado el tama√±o m√°ximo */
      width: 100%; /* Ocupar el 100% del ancho disponible en el wheel-frame */
      height: auto; /* Mantener la proporci√≥n */
      border-radius:50%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    /* Estilos Comunes para Paneles Laterales y Controles */
    .controls {
      background: rgba(0, 0, 0, 0.6); /* Fondo semi-transparente */
      box-shadow: 0 0 15px #005500; /* Sombra verde */
      font-size: 1rem;
      padding: 10px;
      border-radius: 10px;
    }

    /* Estilos para el Panel de Apuestas */
    .controls {
      grid-area: apuestas; /* Asignar al √°rea 'apuestas' */
      display: flex;
      flex-direction: column;
      gap: 12px; /* Aumentado el espacio entre elementos */
      overflow-y: auto;
      /* Altura din√°mica: ajustada para el espacio disponible */
      /* max-height: calc(100vh - 200px); */ /* Eliminado para que se ajuste al contenido */
      padding: 15px; /* Aumentado el padding */
      /* Ajustar el tama√±o para ocupar el espacio restante */
      width: auto; /* Permitir que el ancho se ajuste */
      height: auto; /* Permitir que la altura se ajuste */
    }

    /* Estilos para T√≠tulos de Secci√≥n (Apuestas) */
    .controls h2 {
      margin-top: 0;
      color: #0f0;
      text-align: center;
      text-shadow: 0 0 5px #00ff55;
      font-size: 1.3rem; /* Aumentado el tama√±o de fuente */
    }

    /* Estilos Comunes para Inputs y Botones */
    input, button {
      padding: 10px; /* Aumentado el padding */
      border-radius: 6px;
      border: 2px solid #0f0;
      background: #0a0;
      color: #ddffdd;
      font-size: 1.1rem; /* Aumentado el tama√±o de fuente */
      font-weight: 600;
      text-align: center;
    }
    input:focus {
      outline: none;
      border-color: #6f6;
      background: #0f0;
      color: #003300;
      box-shadow: 0 0 10px #6f6;
    }
    button {
      background-color: #00cc44;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #00bb33;
      box-shadow: 0 0 15px #0f0;
    }

    /* Estilos para la Tabla de Pagos */
    #paymentInfo {
        background: #002200;
        padding: 10px; /* Aumentado el padding */
        border-radius: 8px;
        box-shadow: inset 0 0 10px #0a0;
        margin-bottom: 12px; /* Aumentado el margen */
        font-size: 0.95rem; /* Aumentado el tama√±o de fuente */
        color: #ddffdd;
        text-align: left;
    }
    #paymentInfo h3 {
        margin-top: 0;
        margin-bottom: 5px; /* Aumentado el margen */
        color: #0f0;
        text-align: center;
        text-shadow: none;
        font-size: 1.2rem; /* Aumentado el tama√±o de fuente */
    }
    #paymentInfo p {
        margin: 0;
        line-height: 1.4; /* Aumentado el interlineado */
    }
    #paymentInfo span {
        font-weight: bold;
        color: #0f0;
    }
    #paymentInfo .red-text { color: red; }
    #paymentInfo .black-text { color: #ccc; } /* Color para texto negro en fondo oscuro */
    #paymentInfo .green-text { color: green; }
    #paymentInfo .white-text { color: white; }

    /* Ajustes Espec√≠ficos para la Secci√≥n de Apuestas */
    .controls input, .controls button {
        margin-bottom: 8px; /* Aumentado el margen */
    }
    .controls input:last-of-type, .controls button:last-of-type {
        margin-bottom: 0;
    }

    /* Contenedor para los botones de apostar y girar */
    .bet-spin-buttons {
        display: flex;
        gap: 10px; /* Espacio entre los botones */
        margin-top: 20px;
    }
    .bet-spin-buttons button {
        flex: 1; /* Hace que los botones ocupen el mismo ancho */
        padding: 10px; /* Ajustado el padding para que sean m√°s peque√±os */
        font-size: 1rem; /* Ajustado el tama√±o de fuente */
    }

    /* Estilos para Modales (Configuraci√≥n y Fin de Juego) */
    #configModal, #endGameModal, #infoModal, #playerSelectModal, #adminLoginModal {
        display: none; /* Oculto por defecto */
        position: fixed; /* Fijo en la ventana */
        z-index: 1000; /* Por encima de todo lo dem√°s */
        left: 0; top: 0;
        width: 100%; height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8); /* Fondo oscuro semi-transparente */
        display: flex; /* Usar flexbox para centrar el contenido */
        justify-content: center;
        align-items: center;
    }
    /* Asegurarse de que el modal de fin de juego est√© oculto al inicio */
    #endGameModal {
        display: none;
    }

    .modal-content {
        background: rgba(0, 0, 0, 0.9);
        padding: 25px; /* Aumentado el padding */
        border: 2px solid #0f0;
        border-radius: 15px;
        width: 80%;
        max-width: 450px; /* Aumentado el ancho m√°ximo */
        box-shadow: 0 0 25px #0f0;
        text-align: center;
        color: white;
    }
    .modal-content h2 {
        color: #0f0;
        text-shadow: 0 0 8px #00ff55;
        margin-top: 0;
        font-size: 2rem; /* Aumentado el tama√±o de fuente */
    }
    .modal-content p {
        font-size: 1.1rem; /* Aumentado el tama√±o de fuente */
        margin-bottom: 12px; /* Aumentado el margen */
    }
    .modal-content input {
        width: calc(100% - 20px); /* Ajustado el ancho */
        margin-bottom: 12px; /* Aumentado el margen */
        padding: 12px; /* Aumentado el padding */
        font-size: 1.1rem; /* Aumentado el tama√±o de fuente */
    }
    .modal-content button {
        width: 100%;
        padding: 14px; /* Aumentado el padding */
        font-size: 1.3rem; /* Aumentado el tama√±o de fuente */
        background-color: #00cc44;
        border: 2px solid #0f0;
        margin-top: 12px; /* Espacio entre botones en el modal */
    }
    .modal-content button:hover {
        background-color: #00bb33;
        box-shadow: 0 0 18px #0f0;
    }

    /* Estilos para el Modal de Informaci√≥n */
    #infoModal .modal-content, #playerSelectModal .modal-content {
        max-width: 90%; /* Aumentado el ancho m√°ximo del modal de informaci√≥n */
        height: 90%; /* Aumentado la altura del modal de informaci√≥n */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        padding: 25px; /* Aumentado el padding */
    }

    #infoModal .modal-content h2, #playerSelectModal .modal-content h2 {
        margin-bottom: 25px; /* Aumentado el margen */
    }

    #infoModal .info-columns, #playerSelectModal .player-list-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around; /* Distribuye el espacio entre los elementos */
        width: 100%;
        flex-grow: 1;
        gap: 15px; /* Reducido el espacio entre elementos para mejor ajuste */
        margin-bottom: 25px; /* Aumentado el margen */
    }

    #infoModal .info-column, #playerSelectModal .player-list-container .info-column {
        background: rgba(0, 50, 0, 0.8);
        border: 1px solid #0f0;
        border-radius: 10px;
        padding: 20px; /* Aumentado el padding */
        flex: 1; /* Permite que las columnas crezcan y se encojan */
        min-width: 280px; /* Ajustado el ancho m√≠nimo para mayor flexibilidad */
        max-height: 100%; /* Permite que la caja se estire */
        overflow-y: auto; /* Agrega scroll si el contenido excede la altura */
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        display: flex;
        flex-direction: column;
    }

    /* Estilo espec√≠fico para la columna de Rondas */
    #infoModal .info-column.rondas-info {
        min-width: 200px; /* Ancho m√≠nimo m√°s peque√±o para la columna de rondas */
        max-width: 250px; /* Ancho m√°ximo para que no se estire demasiado */
        flex-grow: 0; /* No permite que crezca tanto como otras columnas */
        order: 100; /* Mover al final de todo */
    }

    #infoModal .info-column h3, #playerSelectModal .player-list-container .info-column h3 {
        color: #0f0;
        text-align: center;
        margin-top: 0;
        margin-bottom: 12px; /* Aumentado el margen */
        font-size: 1.4rem; /* Aumentado el tama√±o de fuente */
        border-bottom: 1px solid rgba(0, 255, 0, 0.3);
        padding-bottom: 8px; /* Aumentado el padding */
    }

    #infoModal .info-column ul, #playerSelectModal .player-list-container .info-column ul {
        list-style: none;
        padding: 0;
        margin: 0;
        flex-grow: 1;
    }

    #infoModal .info-column li, #playerSelectModal .player-list-container .info-column li {
        margin-bottom: 8px; /* Aumentado el margen */
        font-size: 1.05rem; /* Aumentado el tama√±o de fuente */
        color: #ddffdd;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #infoModal .info-column li strong, #playerSelectModal .player-list-container .info-column li strong {
        color: #9ff7c9;
    }

    #infoModal .info-column li button, #playerSelectModal .player-list-container .info-column li button {
        background-color: #cc0000;
        font-size: 0.8rem; /* Aumentado el tama√±o de fuente */
        padding: 4px 8px; /* Aumentado el padding */
        border: 1px solid #ff0000;
        margin-left: 10px; /* Aumentado el margen */
        border-radius: 5px;
    }
    #infoModal .info-column li button:hover, #playerSelectModal .player-list-container .info-column li button:hover {
        background-color: #990000;
        box-shadow: 0 0 5px #ff0000;
    }

    #infoModal .info-column .historial-item {
        border-bottom: 1px dashed rgba(0, 255, 0, 0.1);
        padding-bottom: 8px; /* Aumentado el padding */
        margin-bottom: 8px; /* Aumentado el margen */
    }
    #infoModal .info-column .historial-item:last-child {
        border-bottom: none;
    }
    #infoModal .info-column .historial-item em {
        color: #aaa;
    }
    #infoModal .info-column .historial-item .historial-num {
        font-weight: bold;
        color: #fff;
    }

    /* Estilos para la nueva columna de historial de apuestas */
    #infoModal .info-column.apuestas-historial {
        min-width: 350px; /* Ajustar el ancho para el contenido */
        order: 99; /* Fuerza esta columna a ir al final (derecha) */
    }
    #infoModal .info-column.apuestas-historial ul li {
        flex-direction: column; /* Apilar elementos para mejor lectura */
        align-items: flex-start;
        padding: 5px 0;
    }
    #infoModal .info-column.apuestas-historial ul li span {
        margin-bottom: 3px;
        display: block; /* Asegura que cada span ocupe su propia l√≠nea */
    }
    #infoModal .info-column.apuestas-historial ul li .bet-details {
        font-size: 0.9em;
        color: #ccc;
        display: block; /* Asegura que cada detalle de apuesta ocupe su propia l√≠nea */
    }


    #infoModal .close-button, #playerSelectModal .close-button, #adminLoginModal .close-button {
        background-color: #cc0000;
        border: 2px solid #ff0000;
        width: auto;
        padding: 12px 25px; /* Aumentado el padding */
        font-size: 1.2rem; /* Aumentado el tama√±o de fuente */
        margin-top: 25px; /* Aumentado el margen */
    }
    #infoModal .close-button:hover, #playerSelectModal .close-button:hover, #adminLoginModal .close-button:hover {
        background-color: #990000;
        box-shadow: 0 0 10px #ff0000;
    }

    /* NUEVOS ESTILOS DEL REPRODUCTOR DE M√öSICA */
    .audio-panel-container {
        grid-area: reproductor; /* Asignar al √°rea 'reproductor' */
        display: flex;
        justify-content: center; /* Centrar horizontalmente en su celda */
        align-items: center; /* Centrar verticalmente en su celda */
        padding: 20px;
        width: auto; /* Permitir que el ancho se ajuste */
        height: auto; /* Permitir que la altura se ajuste */
    }

    .audio-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 20px;
      border: 2px solid #0f0;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.8);
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
      max-width: 280px; /* Reducido el tama√±o m√°ximo para hacerlo m√°s peque√±o */
      width: 100%;
    }

    .player-card {
      background: #000;
      border: 1px solid #0f0;
      border-radius: 8px;
      padding: 16px;
      box-shadow: inset 0 0 15px rgba(0, 255, 0, 0.2);
    }

    .player-card h2 {
      margin-top: 0;
      margin-bottom: 14px;
      font-size: 1.2rem;
      color: #0f0;
      text-shadow: 0 0 8px #0f0;
    }

    .controls .audio-controls-group { /* Renombrado para evitar conflicto con .controls general */
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .controls .audio-controls-group button {
      background: #0a0;
      border: 1px solid #0f0;
      padding: 10px 14px;
      border-radius: 6px;
      color: white;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(0,255,0,0.4);
      transition: all 0.15s ease;
    }

    .controls .audio-controls-group button:hover {
      background-color: #0f0;
      color: #000;
      box-shadow: 0 0 15px #0f0;
    }

    .controls .audio-controls-group label {
      font-size: 0.9rem;
      color: #0f0;
    }

    .controls .audio-controls-group input[type="range"] {
      flex: 1;
      min-width: 120px;
      accent-color: #0f0;
    }

    .led-bar {
      height: 4px;
      border-radius: 4px;
      background: linear-gradient(90deg, #0f0, #050);
      margin-top: 12px;
      box-shadow: 0 0 8px #0f0;
      animation: pulse 2s infinite alternate;
    }

    @keyframes pulse {
      from { opacity: 0.6; }
      to { opacity: 1; }
    }

    /* Estilos para los botones de color */
    .color-buttons {
        display: flex;
        justify-content: space-around;
        margin-bottom: 10px;
    }
    .color-buttons button {
        flex: 1;
        margin: 0 5px;
        padding: 10px;
        font-size: 1.1rem;
        font-weight: bold;
        border: 2px solid;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .color-buttons button.red {
        background-color: #cc0000;
        border-color: #ff0000;
        color: white;
    }
    .color-buttons button.red:hover {
        background-color: #990000;
        box-shadow: 0 0 10px #ff0000;
    }
    .color-buttons button.black {
        background-color: #333;
        border-color: #666;
        color: white;
    }
    .color-buttons button.black:hover {
        background-color: #000;
        box-shadow: 0 0 10px #666;
    }
    .color-buttons button.green {
        background-color: #008000;
        border-color: #00ff00;
        color: white;
    }
    .color-buttons button.green:hover {
        background-color: #005500;
        box-shadow: 0 0 10px #00ff00;
    }

    /* Estilo para el bot√≥n de seleccionar jugador */
    .select-player-button {
        background-color: #007bff;
        border-color: #007bff;
        color: white;
        margin-left: 10px; /* Espacio a la izquierda del input */
        flex-shrink: 0; /* Evita que el bot√≥n se encoja */
        width: auto; /* Ajusta el ancho al contenido */
    }
    .select-player-button:hover {
        background-color: #0056b3;
        box-shadow: 0 0 10px #007bff;
    }

    /* Estilos para el modal de selecci√≥n de jugador */
    #playerSelectModal .player-list-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 10px;
        background: #002200;
        border-radius: 8px;
        box-shadow: inset 0 0 10px #0a0;
        max-height: 80%;
        overflow-y: auto;
    }
    #playerSelectModal .player-list-container ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    #playerSelectModal .player-list-container li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        font-size: 1.1rem;
    }
    #playerSelectModal .player-list-container li:last-child {
        border-bottom: none;
    }
    #playerSelectModal .player-list-container li button {
        background-color: #00cc44;
        font-size: 0.9rem;
        padding: 5px 10px;
        border: 1px solid #0f0;
        margin-left: 10px;
        border-radius: 5px;
        width: auto; /* Ajustar el ancho del bot√≥n */
    }
    #playerSelectModal .player-list-container li button:hover {
        background-color: #00bb33;
        box-shadow: 0 0 8px #0f0;
    }

    /* Estilos para el grupo de input de nombre y bot√≥n de seleccionar jugador */
    .player-input-group {
        display: flex;
        align-items: center;
        gap: 10px; /* Espacio entre el input y el bot√≥n */
        margin-bottom: 12px; /* Margen inferior para separar del siguiente elemento */
    }
    .player-input-group input {
        flex-grow: 1; /* Permite que el input ocupe el espacio restante */
        margin-bottom: 0; /* Elimina el margen inferior del input individual */
    }

    /* Estilos para el modal de inicio de sesi√≥n de admin */
    #adminLoginModal .modal-content {
        max-width: 500px;
        padding: 30px;
        border: 3px solid #00ff00;
        box-shadow: 0 0 30px rgba(0, 255, 0, 0.7);
        background: linear-gradient(145deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 20, 0.95));
    }
    #adminLoginModal .modal-content h2 {
        font-size: 2.5rem;
        color: #00ff00;
        text-shadow: 0 0 10px #00ff00;
        margin-bottom: 25px;
    }
    #adminLoginModal .modal-content input {
        background: #1a1a1a;
        border: 1px solid #00cc44;
        color: #ddffdd;
        font-size: 1.2rem;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: inset 0 0 8px rgba(0, 255, 0, 0.2);
    }
    #adminLoginModal .modal-content input:focus {
        border-color: #00ff00;
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
    }
    #adminLoginModal .modal-buttons {
        display: flex;
        justify-content: space-around;
        gap: 20px;
        margin-top: 20px;
    }
    #adminLoginModal .modal-buttons button {
        flex: 1;
        padding: 15px 25px;
        font-size: 1.4rem;
        font-weight: bold;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    #adminLoginModal .modal-buttons button.accept {
        background-color: #00cc44;
        border-color: #00ff00;
    }
    #adminLoginModal .modal-buttons button.accept:hover {
        background-color: #00bb33;
        box-shadow: 0 0 20px #00ff00;
    }
    #adminLoginModal .modal-buttons button.cancel {
        background-color: #cc0000;
        border-color: #ff0000;
    }
    #adminLoginModal .modal-buttons button.cancel:hover {
        background-color: #990000;
        box-shadow: 0 0 20px #ff0000;
    }

  </style>
</head>
<body>

  <!-- Dock de Navegaci√≥n -->
  <nav class="dock">
    <a href="../index.html">Inicio</a>
    <a href="#" onclick="downloadSummary()">Descargar Resumen</a>
    <a href="#" onclick="showInfoModal()">Informaci√≥n</a>
  </nav>

  <!-- Modal de Configuraci√≥n Inicial -->
  <div id="configModal">
    <div class="modal-content">
      <h2>Configuraci√≥n de la Ruleta</h2>
      <p>Dinero inicial por jugador: <input type="number" id="initialMoney" placeholder="Ej: 10000" value="10000" /></p>
      <p>Apuesta m√≠nima: <input type="number" id="minBet" placeholder="Ej: 1000" value="1000" /></p>
      <p>N√∫mero de rondas: <input type="number" id="numRounds" placeholder="Ej: 5" value="5" /></p>
      <button onclick="applyInitialConfig()">Configurar Ruleta</button>
    </div>
  </div>

  <!-- Modal de Fin de Juego -->
  <div id="endGameModal">
    <div class="modal-content">
      <h2>¬°Fin de la Partida!</h2>
      <p id="endGameMessage">Has completado todas las rondas.</p>
      <button onclick="resetGame()">Empezar de Nuevo</button>
      <button onclick="continueGame()">Seguir Jugando</button>
      <button onclick="downloadSummary()">Descargar Resumen</button>
      <button onclick="window.location.href = '../index.html';">Salir</button>
    </div>
  </div>

  <!-- Modal de Informaci√≥n -->
  <div id="infoModal">
    <div class="modal-content">
      <h2>Informaci√≥n de la Partida</h2>
      <div class="info-columns">
        <div class="info-column">
          <h3>Jugadores</h3>
          <ul id="infoJugadoresList"></ul>
        </div>
        <div class="info-column">
          <h3>Historial de Resultados</h3>
          <ul id="infoHistorialResultados"></ul>
        </div>
        <!-- Nuevo panel para jugadores en la ronda actual -->
        <div class="info-column">
          <h3>Jugadores en esta ronda</h3>
          <ul id="infoListaJugadoresEnRonda">
              <!-- Aqu√≠ se listar√°n los jugadores que han apostado -->
          </ul>
        </div>
        <!-- Nueva columna para el historial de apuestas -->
        <div class="info-column apuestas-historial">
            <h3>Historial de Apuestas por Ronda</h3>
            <ul id="infoHistorialApuestas"></ul>
        </div>
        <div class="info-column rondas-info"> <!-- A√±adida clase rondas-info y movida al final -->
          <h3>Rondas</h3>
          <p>Ronda Actual: <strong id="infoCurrentRound">0</strong></p>
          <p>Rondas Totales: <strong id="infoTotalRounds">0</strong></p>
          <p>Rondas Restantes: <strong id="infoRemainingRounds">0</strong></p>
        </div>
      </div>
      <button class="close-button" onclick="closeInfoModal()">Cerrar</button>
    </div>
  </div>

  <!-- Modal de Selecci√≥n de Jugador -->
  <div id="playerSelectModal">
    <div class="modal-content">
      <h2>Seleccionar Jugador</h2>
      <div class="player-list-container">
        <ul id="playerSelectionList">
          <!-- Los jugadores se cargar√°n aqu√≠ din√°micamente -->
        </ul>
      </div>
      <button class="close-button" onclick="closePlayerSelectModal()">Cerrar</button>
    </div>
  </div>

  <!-- Modal de Inicio de Sesi√≥n de Admin -->
  <div id="adminLoginModal">
    <div class="modal-content">
      <h2>Acceso de Administrador</h2>
      <input type="text" id="adminUsername" placeholder="Usuario" />
      <input type="password" id="adminPassword" placeholder="Contrase√±a" />
      <div class="modal-buttons">
        <button class="accept" onclick="checkAdminLogin()">Aceptar</button>
        <button class="cancel" onclick="closeAdminLoginModal()">Volver</button>
      </div>
    </div>
  </div>

  <!-- üé° RULETA (Centro) - HTML DE RULETA2 -->
  <div class="wheel-frame" aria-hidden="true">
    <canvas id="ruletaCanvas" width="620" height="620"></canvas>
  </div>

  <!-- üí∏ APUESTAS (Columna Derecha) -->
  <div class="controls">
    <h2>Apuestas</h2>
    <div id="paymentInfo">
      <h3>Tabla de Pagos</h3>
      <p>
        <span class="red-text">Rojo</span> o <span class="black-text">Negro</span>: <span>2x</span><br>
        <span class="green-text">Verde (0)</span>: <span>36x</span><br>
        <span class="white-text">N√∫mero Exacto</span>: <span>36x</span>
      </p>
    </div>
    <div class="player-input-group">
        <input type="text" id="nombre" placeholder="Tu nombre" />
        <button class="select-player-button" onclick="showPlayerSelectModal()">Seleccionar Jugador</button>
    </div>
    <input type="number" id="dinero" placeholder="Cantidad a apostar" />
    <input type="text" id="apuesta" placeholder="rojo, negro, verde o n√∫mero" />

    <div class="color-buttons">
        <button class="red" onclick="selectBetType('rojo')">Rojo</button>
        <button class="black" onclick="selectBetType('negro')">Negro</button>
        <button class="green" onclick="selectBetType('verde')">Verde</button>
    </div>

    <div class="bet-spin-buttons"> <!-- Nuevo contenedor para los botones -->
        <button onclick="apostar()">Agregar Apuesta</button>
        <button onclick="girarRuleta()">Girar Ruleta</button>
    </div>

  </div>

  <!-- Nuevo Reproductor de M√∫sica (Integrado de copia 2 y movido) -->
  <div class="audio-panel-container">
    <div class="audio-panel">
      <!-- M√∫sica ambiente -->
      <section class="player-card">
        <h2>üé∂ M√∫sica de Ambiente</h2>
        <div class="controls audio-controls-group">
          <button id="musicPlay">‚ñ∂ Reproducir</button>
          <button id="musicPause">‚è∏ Pausar</button>
          <label for="musicVolume">Volumen:</label>
          <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="led-bar"></div>
      </section>

      <!-- Sonido ruleta -->
      <section class="player-card">
        <h2>üé∞ Sonido Ruleta</h2>
        <div class="controls audio-controls-group">
          <button id="spinPlay">üîä Reproducir</button>
          <button id="spinPause">‚è∏ Pausar</button>
          <label for="spinVolume">Volumen:</label>
          <input type="range" id="spinVolume" min="0" max="1" step="0.01" value="0.8">
        </div>
        <div class="led-bar"></div>
      </section>
    </div>
  </div>

  <!-- Archivos de audio para el nuevo reproductor -->
  <audio id="musicAudio" src="ambiente.mp3" loop></audio>
  <audio id="spinAudio" src="ruleta.mp3"></audio>

  <script>
    const canvas = document.getElementById("ruletaCanvas");
    const ctx = canvas.getContext("2d");
    const inputNombre = document.getElementById("nombre");
    const inputApuesta = document.getElementById("apuesta");
    const inputDinero = document.getElementById("dinero");

    // Elementos del modal de configuraci√≥n
    const configModal = document.getElementById("configModal");
    const initialMoneyInput = document.getElementById("initialMoney");
    const minBetInput = document.getElementById("minBet");
    const numRoundsInput = document.getElementById("numRounds");

    // Elementos del modal de fin de juego
    const endGameModal = document.getElementById("endGameModal");
    const endGameMessage = document.getElementById("endGameMessage");

    // Elementos del modal de informaci√≥n
    const infoModal = document.getElementById("infoModal");
    const infoJugadoresList = document.getElementById("infoJugadoresList");
    const infoCurrentRound = document.getElementById("infoCurrentRound");
    const infoTotalRounds = document.getElementById("infoTotalRounds");
    const infoRemainingRounds = document.getElementById("infoRemainingRounds");
    const infoHistorialResultados = document.getElementById("infoHistorialResultados");
    const infoListaJugadoresEnRonda = document.getElementById("infoListaJugadoresEnRonda");
    const infoHistorialApuestas = document.getElementById("infoHistorialApuestas");

    // Elementos del modal de selecci√≥n de jugador
    const playerSelectModal = document.getElementById("playerSelectModal");
    const playerSelectionList = document.getElementById("playerSelectionList");

    // Elementos del modal de inicio de sesi√≥n de admin
    const adminLoginModal = document.getElementById("adminLoginModal");
    const adminUsernameInput = document.getElementById("adminUsername");
    const adminPasswordInput = document.getElementById("adminPassword");

    // Referencias a los elementos de audio y sus controles
    const musicAudio = document.getElementById("musicAudio");
    const spinAudio = document.getElementById("spinAudio");

    const musicPlayButton = document.getElementById("musicPlay");
    const musicPauseButton = document.getElementById("musicPause");
    const musicVolumeSlider = document.getElementById("musicVolume");

    const spinPlayButton = document.getElementById("spinPlay");
    const spinPauseButton = document.getElementById("spinPause");
    const spinVolumeSlider = document.getElementById("spinVolume");

    // Event Listeners para los botones de audio
    musicPlayButton.addEventListener("click", () => {
      musicAudio.volume = parseFloat(musicVolumeSlider.value);
      musicAudio.play().catch(err => console.log("Autoplay bloqueado:", err));
    });
    musicPauseButton.addEventListener("click", () => musicAudio.pause());
    musicVolumeSlider.addEventListener("input", (e) => {
      musicAudio.volume = parseFloat(e.target.value);
    });

    spinPlayButton.addEventListener("click", () => {
      spinAudio.volume = parseFloat(spinVolumeSlider.value);
      spinAudio.currentTime = 0; // Reinicia el sonido cada vez que se reproduce
      spinAudio.play().catch(err => console.log("Autoplay bloqueado:", err));
    });
    spinPauseButton.addEventListener("click", () => spinAudio.pause());
    spinVolumeSlider.addEventListener("input", (e) => {
      spinAudio.volume = parseFloat(e.target.value);
    });

    /* --- ESTADO DE LA RULETA --- */
    // Orden de los n√∫meros en una ruleta europea real (alternando rojo/negro, 0 verde)
    const ordenRuleta = [
      0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5,
      24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26
    ];

    // N√∫meros rojos en una ruleta europea
    const redNumbers = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];

    const numeros = ordenRuleta.map(n => {
      const color = n === 0 ? 'green' : (redNumbers.includes(n) ? 'red' : 'black');
      return { num: n, color };
    });

    let dineroJugador = {};
    let apuestas = [], yaApostaron = new Set();
    let retiredPlayers = new Set(); // Nuevo Set para jugadores retirados

    // Variables de animaci√≥n de la ruleta
    let currentAngle = 0;
    let bolaAngle = 0;
    let bolaRadialDistance = 0; // Variable para la distancia radial de la bola
    let animando = false;

    // Ajustar radios de la ruleta para el nuevo tama√±o (620px)
    const outerBallTrackRadius = (canvas.width / 2) - 24; // Radio exterior de la pista de la bola
    const innerBallTrackRadius = 70 + 30; // Radio interior de la pista de la bola
    const finalBallSettleRadius = (canvas.width / 2) - 55; // Posici√≥n final de la bola

    // Variables de control de rondas y historial
    let initialPlayerMoney = 10000;
    let minimumBet = 1000;
    let totalRounds = 5;
    let currentRound = 0;
    let gameConfigured = false;
    let gameHistory = [];
    let gameStartTime = null;

    /* --- RUTINAS DE DIBUJO --- */
    function drawRuleta(angle = 0) {
      const w = canvas.width, h = canvas.height;
      ctx.clearRect(0,0,w,h);
      const cx = w/2, cy = h/2;
      const radius = Math.min(w,h)/2 - 24;
      const slice = (2*Math.PI) / numeros.length;

      for (let i=0;i<numeros.length;i++) {
        const start = angle + i*slice;
        const end = start + slice;
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,radius,start,end);
        ctx.closePath();
        ctx.fillStyle = numeros[i].color === 'green' ? '#37d08a' : (numeros[i].color === 'red' ? '#d43b3b' : '#1b1b1b');
        ctx.fill();
        ctx.strokeStyle = '#463419';
        ctx.lineWidth = 2;
        ctx.stroke();

        // n√∫mero
        ctx.save();
        ctx.translate(cx,cy);
        ctx.rotate(start + slice/2);
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 18px Arial';
        ctx.textAlign = 'right';
        ctx.shadowColor = 'rgba(0,0,0,0.6)';
        ctx.shadowBlur = 6;
        ctx.fillText(String(numeros[i].num), radius - 18, 6);
        ctx.restore();
      }

      // c√≠rculo central
      ctx.beginPath();
      ctx.arc(cx,cy,70,0,2*Math.PI);
      const g = ctx.createRadialGradient(cx-10,cy-10,8,cx,cy,70);
      g.addColorStop(0,'#0b3c1f'); g.addColorStop(1,'#05120a');
      ctx.fillStyle = g;
      ctx.fill();
      ctx.strokeStyle = '#2f8a5a';
      ctx.lineWidth = 2;
      ctx.stroke();

      // bola
      const bx = cx + Math.cos(bolaAngle) * bolaRadialDistance;
      const by = cy + Math.sin(bolaAngle) * bolaRadialDistance;
      drawBall(bx,by);
    }

    function drawBall(x,y) {
      ctx.beginPath();
      ctx.arc(x,y,10,0,2*Math.PI);
      const g = ctx.createRadialGradient(x-3,y-3,1,x,y,10);
      g.addColorStop(0,'#fff'); g.addColorStop(1,'#cfcfcf');
      ctx.fillStyle = g;
      ctx.fill();
      ctx.strokeStyle = '#888';
      ctx.stroke();
      ctx.shadowBlur = 12;
      ctx.shadowColor = '#fff';
    }

    function actualizarJugadoresEnRonda() {
        infoListaJugadoresEnRonda.innerHTML = ""; // Usar el elemento en el modal de informaci√≥n
        if (yaApostaron.size === 0) {
            infoListaJugadoresEnRonda.innerHTML = "<li>Nadie ha apostado a√∫n.</li>";
            return;
        }
        yaApostaron.forEach(nombreJugador => {
            const li = document.createElement("li");
            const apuestaJugador = apuestas.find(a => a.nombre === nombreJugador);
            if (apuestaJugador) {
                li.innerHTML = `
                    <span>${nombreJugador} (${apuestaJugador.apuesta.toUpperCase()} $${apuestaJugador.monto})</span>
                    <button onclick="cancelarApuesta('${nombreJugador}')">Cancelar</button>
                `;
                infoListaJugadoresEnRonda.appendChild(li);
            }
        });
    }

    function apostar() {
      if (!gameConfigured) {
          alert("Por favor, configura el juego primero.");
          return;
      }
      if (animando) {
          alert("No puedes apostar mientras la ruleta est√° girando.");
          return;
      }

      const nombre = inputNombre.value.trim();
      const monto = parseInt(inputDinero.value);
      const validNumbers = numeros.map(n=>String(n.num));
      const validos = ['rojo','negro','verde', ...validNumbers];
      const apuesta = inputApuesta.value.trim().toLowerCase();

      if (retiredPlayers.has(nombre)) {
          alert(`${nombre} se ha retirado del juego y no puede apostar.`);
          return;
      }

      if (!nombre || !apuesta || isNaN(monto) || !validos.includes(apuesta)) {
        return alert("Datos inv√°lidos. Aseg√∫rate de rellenar todos los campos y que la apuesta sea v√°lida (rojo, negro, verde o un n√∫mero).");
      }
      if (monto < minimumBet) {
        return alert(`La apuesta m√≠nima es de ${minimumBet} monedas.`);
      }

      if (!dineroJugador[nombre]) {
          dineroJugador[nombre] = initialPlayerMoney;
      }

      if (yaApostaron.has(nombre)) {
          return alert("Ya apostaste en esta ronda. Solo se permite una apuesta por jugador por ronda.");
      }
      if (dineroJugador[nombre] < monto) {
          return alert("Dinero insuficiente.");
      }

      dineroJugador[nombre] -= monto;
      apuestas.push({ nombre, apuesta, monto });
      yaApostaron.add(nombre);
      inputNombre.value = inputApuesta.value = inputDinero.value = "";
      actualizarApuestas(); // Esto ahora mostrar√° un alert con las apuestas
      actualizarJugadoresEnRonda();
    }

    function cancelarApuesta(nombreJugador) {
        if (animando) {
            alert("No puedes cancelar apuestas mientras la ruleta est√° girando.");
            return;
        }
        // Buscar la apuesta en la lista de apuestas
        const index = apuestas.findIndex(a => a.nombre === nombreJugador);
        if (index > -1) {
            const apuestaCancelada = apuestas[index];
            dineroJugador[nombreJugador] += apuestaCancelada.monto;
            apuestas.splice(index, 1); // Eliminar la apuesta del array
            yaApostaron.delete(nombreJugador); // Eliminar del Set de jugadores que ya apostaron

            alert(`Apuesta de ${nombreJugador} cancelada. Se le devolvieron $${apuestaCancelada.monto}.`);
            actualizarApuestas(); // Esto ahora mostrar√° un alert con las apuestas
            actualizarJugadoresEnRonda();
        } else {
            alert("Este jugador no tiene una apuesta activa para cancelar.");
        }
    }

    function removePlayer(playerName) {
        if (confirm(`¬øEst√°s seguro de que quieres eliminar a ${playerName} del juego? Su dinero actual ($${dineroJugador[playerName]}) se perder√°.`)) {
            // Registrar el retiro del jugador
            retiredPlayers.add(playerName);
            gameHistory.push({
                round: currentRound + 1,
                event: 'player_retired',
                playerName: playerName,
                moneyAtRetirement: dineroJugador[playerName]
            });

            // Eliminar al jugador de las apuestas activas si las tiene
            if (yaApostaron.has(playerName)) {
                const apuestaCancelada = apuestas.find(a => a.nombre === playerName);
                if (apuestaCancelada) {
                    // No se devuelve el dinero, se considera perdido al retirarse
                    apuestas = apuestas.filter(a => a.nombre !== playerName);
                    yaApostaron.delete(playerName);
                }
            }

            // Eliminar al jugador de la lista de dineroJugador
            delete dineroJugador[playerName];

            alert(`${playerName} ha sido eliminado del juego.`);
            updateInfoModalContent(); // Actualizar la lista de jugadores en el modal de informaci√≥n
            actualizarApuestas(); // Por si ten√≠a apuestas activas
            actualizarJugadoresEnRonda(); // Por si estaba en la lista de jugadores en ronda
        }
    }

    /* --- GIRAR RULETA y c√°lculo de ganador --- */
    function girarRuleta(isTestSpin = false) { // A√±adido par√°metro para giros de prueba
      if (!gameConfigured && !isTestSpin) { alert('Configura la partida primero.'); return; }
      if (animando) return;
      if (apuestas.length===0 && !isTestSpin) { alert('No hay apuestas.'); return; }

      const roundObj = {
        round: currentRound + 1,
        initialPlayerBalances: {...dineroJugador},
        bets: JSON.parse(JSON.stringify(apuestas)), // Guardar las apuestas de esta ronda
        result: null,
        winners: [],
        finalPlayerBalances: null,
        retiredPlayersInRound: [...retiredPlayers], // Registrar jugadores retirados en esta ronda
        isTest: isTestSpin // Marcar si es un giro de prueba
      };
      gameHistory.push(roundObj);

      spinAudio.volume = parseFloat(spinVolumeSlider.value || 0.8);
      spinAudio.play().catch(()=>{ /* ignore */ });

      const minVueltasRuleta = 5;
      const minVueltasBola = 10;

      const randomAddVueltasRuleta = Math.random() * 5;
      const randomAddVueltasBola = Math.random() * 8;

      const totalVueltasRuleta = minVueltasRuleta + randomAddVueltasRuleta;
      const totalVueltasBola = minVueltasBola + randomAddVueltasBola;

      const finalRotationRuleta = currentAngle + (totalVueltasRuleta * 2 * Math.PI);
      const finalRotationBola = bolaAngle + (totalVueltasBola * 2 * Math.PI);

      const duracionAnimacion = 8000;

      const initialAngleRuleta = currentAngle;
      const initialAngleBola = bolaAngle;
      const initialRadialDistanceBola = outerBallTrackRadius;

      animando = true;
      let start = null;

      const easeOutCubic = x => 1 - Math.pow(1 - x, 3);
      const easeInQuad = x => x * x;

      function animar(ts) {
        if (!start) start = ts;
        const t = ts - start;
        const prog = Math.min(t / duracionAnimacion, 1);

        const easedProg = easeOutCubic(prog);

        currentAngle = initialAngleRuleta + (finalRotationRuleta - initialAngleRuleta) * easedProg;
        bolaAngle = initialAngleBola + (finalRotationBola - initialAngleBola) * easedProg;

        bolaRadialDistance = initialRadialDistanceBola + (finalBallSettleRadius - initialRadialDistanceBola) * easeInQuad(prog);

        const oscillationAmplitude = 10 * (1 - prog);
        const oscillationFrequency = 20;
        bolaRadialDistance += Math.sin(prog * Math.PI * oscillationFrequency) * oscillationAmplitude;

        bolaRadialDistance = Math.max(bolaRadialDistance, innerBallTrackRadius);

        drawRuleta(currentAngle);

        if (prog < 1) {
          requestAnimationFrame(animar);
        } else {
          animando = false;
          spinAudio.pause();
          spinAudio.currentTime = 0;

          currentAngle = currentAngle % (2 * Math.PI);
          bolaAngle = bolaAngle % (2 * Math.PI);
          bolaRadialDistance = finalBallSettleRadius;

          drawRuleta(currentAngle);

          const slice = (2 * Math.PI) / numeros.length;
          let winnerIndex = -1;

          // Calcular el √°ngulo relativo de la bola respecto a la ruleta
          let finalRelativeAngle = (bolaAngle - currentAngle);
          // Normalizar el √°ngulo para que est√© entre 0 y 2*PI
          finalRelativeAngle = finalRelativeAngle % (2 * Math.PI);
          if (finalRelativeAngle < 0) {
              finalRelativeAngle += (2 * Math.PI);
          }

          // Determinar el √≠ndice del n√∫mero ganador
          winnerIndex = Math.floor(finalRelativeAngle / slice);

          // Asegurarse de que el √≠ndice est√© dentro de los l√≠mites del array de n√∫meros
          if (winnerIndex < 0 || winnerIndex >= numeros.length) {
              winnerIndex = 0; // Fallback, aunque no deber√≠a ocurrir con la normalizaci√≥n
          }

          const winner = numeros[winnerIndex];
          procesarResultado(winner, isTestSpin); // Pasar isTestSpin a procesarResultado
        }
      }
      requestAnimationFrame(animar);
    }

    function procesarResultado(winner, isTestSpin = false) { // A√±adido par√°metro
      // Obtener el color del n√∫mero ganador directamente del objeto 'winner'
      const colorEsp = winner.color === 'red' ? 'rojo' : (winner.color === 'black' ? 'negro' : 'verde');
      let hubo = false;
      let winnersRound = [];

      if (!isTestSpin) { // Solo procesar apuestas si no es un giro de prueba
        apuestas.forEach(a=>{
          let premio = 0;

          // 1. Apuesta a n√∫mero exacto
          if (a.apuesta === String(winner.num)) {
            premio = a.monto * 36;
          }
          // 2. Apuesta a color (rojo/negro) - SOLO si el n√∫mero ganador NO es 0
          else if (winner.num !== 0) {
              if ((a.apuesta === 'rojo' && winner.color === 'red') ||
                  (a.apuesta === 'negro' && winner.color === 'black')) {
                  premio = a.monto * 2;
              }
          }
          // 3. Apuesta a verde (solo si el n√∫mero ganador es 0)
          else if (winner.num === 0 && a.apuesta === 'verde') {
              premio = a.monto * 36; // El 0 paga 36x
          }

          if (premio > 0) {
            dineroJugador[a.nombre] = (dineroJugador[a.nombre] || 0) + premio;
            winnersRound.push({ name: a.nombre, winnings: premio });
            hubo = true;
          }
        });
      }

      const last = gameHistory[gameHistory.length - 1];
      if (last) {
        last.result = { num: winner.num, color: colorEsp }; // Usar colorEsp aqu√≠
        last.winners = winnersRound;
        last.finalPlayerBalances = { ...dineroJugador };
      }

      if (!isTestSpin) { // Limpiar apuestas solo si no es un giro de prueba
        apuestas = [];
        yaApostaron.clear();
        currentRound++;
      }

      actualizarApuestas(); // Esto ahora mostrar√° un alert con las apuestas
      actualizarJugadoresEnRonda();
      updateInfoModalContent(); // Actualizar el modal de informaci√≥n despu√©s de cada giro

      if (currentRound >= totalRounds && !isTestSpin) {
        setTimeout(()=> {
          showEndGameModal();
        }, 600);
      }
    }

    function showConfigModal() {
        configModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function applyInitialConfig() {
        const newInitialMoney = parseInt(initialMoneyInput.value);
        const newMinBet = parseInt(minBetInput.value);
        const newNumRounds = parseInt(numRoundsInput.value);

        if (isNaN(newInitialMoney) || newInitialMoney <= 0) {
            alert("Por favor, introduce una cantidad v√°lida para el dinero inicial (mayor que 0).");
            return;
        }
        if (isNaN(newMinBet) || newMinBet <= 0) {
            alert("Por favor, introduce una cantidad v√°lida para la apuesta m√≠nima (mayor que 0).");
            return;
        }
        if (isNaN(newNumRounds) || newNumRounds <= 0) {
            alert("Por favor, introduce un n√∫mero v√°lido de rondas (mayor que 0).");
            return;
        }

        initialPlayerMoney = newInitialMoney;
        minimumBet = newMinBet;
        totalRounds = newNumRounds;
        currentRound = 0;
        gameHistory = [];
        dineroJugador = {};
        retiredPlayers.clear(); // Limpiar jugadores retirados al iniciar nueva partida
        gameStartTime = new Date();

        gameConfigured = true;

        configModal.style.display = 'none';
        document.body.style.overflow = '';

        // Inicializar la posici√≥n de la bola y la ruleta
        currentAngle = 0;
        bolaAngle = 0;
        bolaRadialDistance = outerBallTrackRadius; // La bola empieza en el exterior

        drawRuleta();
        actualizarApuestas(); // Esto ahora mostrar√° un alert con las apuestas
        actualizarJugadoresEnRonda();
    }

    function showEndGameModal() {
        endGameMessage.textContent = `¬°Has completado las ${totalRounds} rondas!`;
        endGameModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function resetGame() {
        endGameModal.style.display = 'none';
        document.body.style.overflow = '';
        showConfigModal();
    }

    function continueGame() {
        endGameModal.style.display = 'none';
        document.body.style.overflow = '';
        totalRounds += 5;
        alert(`¬°Has decidido seguir jugando! Se han a√±adido 5 rondas m√°s. Total de rondas: ${totalRounds}`);
    }

    function downloadSummary() {
        const endTime = new Date();
        let summaryContent = `--- Resumen de Partida de Ruleta Casino ---\n\n`;
        summaryContent += `Fecha de Inicio: ${gameStartTime ? gameStartTime.toLocaleString() : 'N/A'}\n`;
        summaryContent += `Fecha de Fin: ${endTime.toLocaleString()}\n`;
        summaryContent += `Configuraci√≥n Inicial:\n`;
        summaryContent += `  Dinero Inicial por Jugador: $${initialPlayerMoney}\n`;
        summaryContent += `  Apuesta M√≠nima: $${minimumBet}\n`;
        summaryContent += `  Rondas Configuradas: ${totalRounds}\n`;
        summaryContent += `  Rondas Jugadas: ${currentRound}\n\n`;

        summaryContent += `--- Saldos Finales de Jugadores Activos ---\n`;
        if (Object.keys(dineroJugador).length === 0) {
            summaryContent += "No hubo jugadores activos al final de la partida.\n\n";
        } else {
            let winnerName = "N/A";
            let maxMoney = -Infinity;
            let allPlayersLost = true;
            for (const player in dineroJugador) {
                summaryContent += `  ${player}: $${dineroJugador[player]}\n`;
                if (dineroJugador[player] > maxMoney) {
                    maxMoney = dineroJugador[player];
                    winnerName = player;
                }
                if (dineroJugador[player] > initialPlayerMoney) {
                    allPlayersLost = false;
                }
            }
            if (allPlayersLost && Object.keys(dineroJugador).length > 0) {
                summaryContent += `\nNo hubo un ganador claro entre los jugadores activos. Todos perdieron dinero o se quedaron con el inicial.\n\n`;
            } else {
                summaryContent += `\nGanador de la Partida (entre activos): ${winnerName} con $${maxMoney}!\n\n`;
            }
        }

        summaryContent += `--- Jugadores Retirados Durante la Partida ---\n`;
        if (retiredPlayers.size === 0) {
            summaryContent += "No hubo jugadores que se retiraran durante la partida.\n\n";
        } else {
            retiredPlayers.forEach(player => {
                const retirementEvent = gameHistory.find(entry => entry.event === 'player_retired' && entry.playerName === player);
                if (retirementEvent) {
                    summaryContent += `  ${player} se retir√≥ en la ronda ${retirementEvent.round} con $${retirementEvent.moneyAtRetirement} en su poder.\n`;
                } else {
                    summaryContent += `  ${player} se retir√≥ (detalles no disponibles).\n`;
                }
            });
            summaryContent += "\n";
        }


        summaryContent += `--- Historial Detallado de Rondas ---\n`;
        if (gameHistory.length === 0) {
            summaryContent += "No se jug√≥ ninguna ronda.\n";
        } else {
            gameHistory.forEach(round => {
                if (round.event === 'player_retired') {
                    summaryContent += `\n--- Ronda ${round.round} - Evento: Retiro de Jugador ---\n`;
                    summaryContent += `  ${round.playerName} se retir√≥ del juego con $${round.moneyAtRetirement}.\n`;
                } else {
                    summaryContent += `\n--- Ronda ${round.round} ---\n`;
                    for (const player in round.initialPlayerBalances) {
                        summaryContent += `    ${player}: $${round.initialPlayerBalances[player]}\n`;
                    }
                    summaryContent += `  Apuestas realizadas:\n`;
                    if (round.bets.length === 0) {
                        summaryContent += `    Ninguna.\n`;
                    } else {
                        round.bets.forEach(bet => {
                            summaryContent += `    ${bet.nombre} apost√≥ $${bet.monto} a ${bet.apuesta.toUpperCase()}\n`;
                        });
                    }
                    summaryContent += `  Resultado: ${round.result ? `${round.result.num} (${round.result.color.toUpperCase()})` : 'N/A'}\n`;
                    summaryContent += `  Ganadores:\n`;
                    if (round.winners.length === 0) {
                        summaryContent += `    No hubo ganadores.\n`;
                    } else {
                        round.winners.forEach(winner => {
                            summaryContent += `    ${winner.name} gan√≥ $${winner.winnings}\n`;
                        });
                    }
                    summaryContent += `  Saldos al final de la ronda:\n`;
                    for (const player in round.finalPlayerBalances) {
                        summaryContent += `    ${player}: $${round.finalPlayerBalances[player]}\n`;
                    }
                }
            });
        }

        const netResults = {};
        // Calcular resultados netos solo para jugadores que no se retiraron
        for (const player in dineroJugador) {
            if (!retiredPlayers.has(player)) {
                netResults[player] = dineroJugador[player] - initialPlayerMoney;
            }
        }

        summaryContent += `\n--- Resumen de Ganancias/P√©rdidas Netas (Jugadores Activos) ---\n`;
        if (Object.keys(netResults).length === 0) {
            summaryContent += "No hay datos de ganancias/p√©rdidas netas para jugadores activos.\n";
        } else {
            for (const player in netResults) {
                const status = netResults[player] >= 0 ? 'gan√≥' : 'perdi√≥';
                summaryContent += `  ${player}: ${status} $${Math.abs(netResults[player])}\n`;
            }
        }

        const formattedDate = gameStartTime ? gameStartTime.toLocaleDateString('es-ES', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '-') : 'FechaDesconocida';
        const formattedTime = gameStartTime ? gameStartTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' }).replace(/:/g, '-') : 'HoraDesconocida';
        const fileName = `Ruleta Casino - ${formattedDate} ${formattedTime}.txt`;

        const blob = new Blob([summaryContent], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        alert("Resumen de la partida descargado.");
    }

    // Funciones para el modal de informaci√≥n
    function showInfoModal() {
        updateInfoModalContent();
        infoModal.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Evita el scroll del body
    }

    function closeInfoModal() {
        infoModal.style.display = 'none';
        document.body.style.overflow = ''; // Restaura el scroll del body
    }

    function updateInfoModalContent() {
        // Actualizar Jugadores
        infoJugadoresList.innerHTML = "";
        if (Object.keys(dineroJugador).length === 0) {
            infoJugadoresList.innerHTML = "<li>No hay jugadores activos.</li>";
        } else {
            for (const playerName in dineroJugador) {
                const li = document.createElement("li");
                li.innerHTML = `
                    <span>${playerName}: <strong>$${dineroJugador[playerName]}</strong></span>
                    <button onclick="removePlayer('${playerName}')">Eliminar</button>
                `;
                infoJugadoresList.appendChild(li);
            }
        }

        // Actualizar Rondas
        infoCurrentRound.textContent = currentRound;
        infoTotalRounds.textContent = totalRounds;
        infoRemainingRounds.textContent = Math.max(totalRounds - currentRound, 0);

        // REPROGRAMACI√ìN DEL HISTORIAL DE RESULTADOS
        infoHistorialResultados.innerHTML = "";
        if (gameHistory.length === 0) {
            infoHistorialResultados.innerHTML = "<li>No se ha jugado ninguna ronda.</li>";
        } else {
            // Iterar sobre el historial de juego en orden inverso para mostrar lo m√°s reciente primero
            for (let i = gameHistory.length - 1; i >= 0; i--) {
                const round = gameHistory[i];
                const li = document.createElement("li");
                li.classList.add("historial-item");

                if (round.event === 'player_retired') {
                    li.innerHTML = `
                        <strong>Ronda ${round.round}:</strong>
                        <em>${round.playerName} se retir√≥ con $${round.moneyAtRetirement}.</em>
                    `;
                } else {
                    // Asegurarse de que round.result exista antes de acceder a sus propiedades
                    const resultNum = round.result ? round.result.num : 'N/A';
                    const resultColor = round.result ? round.result.color : 'N/A'; // 'rojo', 'negro', 'verde'

                    let colorClass = '';
                    let colorText = '';

                    if (resultColor === 'rojo') {
                        colorClass = 'red-text';
                        colorText = 'ROJO';
                    } else if (resultColor === 'negro') {
                        colorClass = 'black-text';
                        colorText = 'NEGRO';
                    } else if (resultColor === 'verde') {
                        colorClass = 'green-text';
                        colorText = 'VERDE';
                    } else {
                        colorClass = 'white-text'; // Default para 'N/A' o inesperado
                        colorText = 'N/A';
                    }

                    const testSpinLabel = round.isTest ? '(E)' : ''; // Etiqueta "(E)" para giros de prueba

                    const winnersHtml = round.winners.length > 0
                        ? round.winners.map(w => `${w.name} ($${w.winnings})`).join(', ')
                        : '<em>No hubo ganadores.</em>';

                    // Nuevo formato: Ronda x: n¬∫ color n¬∫ ganadores
                    li.innerHTML = `
                        <strong>Ronda ${round.round}${testSpinLabel}:</strong> ${resultNum} <span class="${colorClass}">${colorText}</span> - Ganadores: ${winnersHtml}
                    `;
                }
                infoHistorialResultados.appendChild(li); // A√±adir al final para que el bucle inverso lo ponga en orden correcto
            }
        }

        // Actualizar Jugadores en esta ronda (en el modal de informaci√≥n)
        actualizarJugadoresEnRonda();

        // Actualizar Historial de Apuestas por Ronda (VERTICAL)
        infoHistorialApuestas.innerHTML = "";
        if (gameHistory.length === 0) {
            infoHistorialApuestas.innerHTML = "<li>No se han registrado apuestas.</li>";
        } else {
            // Iterar sobre el historial de juego en orden inverso para mostrar lo m√°s reciente primero
            for (let i = gameHistory.length - 1; i >= 0; i--) {
                const round = gameHistory[i];
                // Solo mostrar rondas que no son de prueba y tienen apuestas
                if (!round.isTest && round.bets && round.bets.length > 0) {
                    const li = document.createElement("li");
                    li.innerHTML = `<strong>Ronda ${round.round}:</strong>`;
                    round.bets.forEach(bet => {
                        const betDetail = document.createElement("div"); // Usar div para asegurar bloque
                        betDetail.classList.add("bet-details");
                        betDetail.innerHTML = `&nbsp;&nbsp;${bet.nombre} apost√≥ $${bet.monto} a ${bet.apuesta.toUpperCase()}`;
                        li.appendChild(betDetail);
                    });
                    infoHistorialApuestas.appendChild(li); // A√±adir al final para que el bucle inverso lo ponga en orden correcto
                }
            }
        }
    }

    // Funciones para el modal de selecci√≥n de jugador
    function showPlayerSelectModal() {
        playerSelectionList.innerHTML = "";
        if (Object.keys(dineroJugador).length === 0) {
            playerSelectionList.innerHTML = "<li>No hay jugadores activos.</li>";
        } else {
            for (const playerName in dineroJugador) {
                if (!retiredPlayers.has(playerName)) { // Solo mostrar jugadores no retirados
                    const li = document.createElement("li");
                    li.innerHTML = `
                        <span>${playerName}: <strong>$${dineroJugador[playerName]}</strong></span>
                        <button onclick="selectPlayer('${playerName}')">Seleccionar</button>
                    `;
                    playerSelectionList.appendChild(li);
                }
            }
        }
        playerSelectModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closePlayerSelectModal() {
        playerSelectModal.style.display = 'none';
        document.body.style.overflow = '';
    }

    function selectPlayer(playerName) {
        inputNombre.value = playerName;
        inputDinero.value = minimumBet; // Cantidad por defecto
        closePlayerSelectModal();
    }

    function selectBetType(type) {
        inputApuesta.value = type;
    }

    // NUEVA FUNCIONALIDAD: Giro de prueba de la ruleta y login de admin
    canvas.addEventListener('click', function(event) {
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));

        // Detectar clic en el centro de la ruleta (aproximadamente el c√≠rculo central)
        if (distance < 70) { // 70 es el radio del c√≠rculo central
            showAdminLoginModal();
        }
    });

    function showAdminLoginModal() {
        adminLoginModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        adminUsernameInput.value = ''; // Limpiar campos
        adminPasswordInput.value = '';
        adminUsernameInput.focus(); // Poner el foco en el campo de usuario
    }

    function closeAdminLoginModal() {
        adminLoginModal.style.display = 'none';
        document.body.style.overflow = '';
    }

    function checkAdminLogin() {
        const username = adminUsernameInput.value;
        const password = adminPasswordInput.value;

        if (username === "admin" && password === "1234") {
            closeAdminLoginModal();
            girarRuleta(true); // Llamar a girarRuleta con isTestSpin = true
        } else {
            alert("Credenciales incorrectas. No se puede iniciar el giro de prueba.");
            adminPasswordInput.value = ''; // Limpiar solo la contrase√±a
            adminUsernameInput.focus(); // Volver a poner el foco en el usuario
        }
    }

    window.onload = showConfigModal;
  </script>
</body>
</html>
